<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cream Choice Traditional - Helados a base de Yogurt Griego</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        cream: '#F5F5DC',
                        strawberry: '#FF6B9D',
                        chocolate: '#8B4513',
                        passion: '#FFA500',
                        lucuma: '#FFD700',
                        blueberry: '#6A5ACD',
                        pineapple: '#FFD700',
                        elegant: '#2C2C2C'
                    },
                    fontFamily: {
                        'display': ['Poppins', 'sans-serif'],
                        'body': ['Inter', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background: linear-gradient(135deg, #F5F5DC 0%, #FFFFFF 50%, #F9F9F9 100%);
            font-family: 'Inter', sans-serif;
        }
        .card-elegant {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        .card-elegant:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.15);
        }
        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .gradient-text {
            background: linear-gradient(45deg, #FF6B9D, #FFA500, #FFD700, #6A5ACD);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        .ice-cream-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .ice-cream-card:hover {
            transform: scale(1.02);
        }
        .pulse-gentle {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        .chat-bot {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
        }
        .chat-window {
            width: 350px;
            height: 450px;
            background: white;
            border-radius: 16px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(10px);
            display: none;
            flex-direction: column;
        }
        .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        .message {
            max-width: 80%;
            padding: 12px 16px;
            border-radius: 18px;
            font-size: 14px;
            line-height: 1.4;
        }
        .message.bot {
            background: linear-gradient(45deg, #FF6B9D, #FFA500);
            color: white;
            align-self: flex-start;
        }
        .message.user {
            background: #f3f4f6;
            color: #2C2C2C;
            align-self: flex-end;
        }
        .chat-input {
            padding: 20px;
            border-top: 1px solid #e5e7eb;
        }
        .typing {
            display: none;
            align-items: center;
            gap: 8px;
            padding: 12px 16px;
            background: #f3f4f6;
            border-radius: 18px;
            align-self: flex-start;
            max-width: 80%;
        }
        .typing-dots {
            display: flex;
            gap: 4px;
        }
        .typing-dot {
            width: 8px;
            height: 8px;
            background: #9ca3af;
            border-radius: 50%;
            animation: typing 1.4s infinite;
        }
        .typing-dot:nth-child(2) {
            animation-delay: 0.2s;
        }
        .typing-dot:nth-child(3) {
            animation-delay: 0.4s;
        }
        @keyframes typing {
            0%, 60%, 100% {
                transform: translateY(0);
                opacity: 0.4;
            }
            30% {
                transform: translateY(-10px);
                opacity: 1;
            }
        }
        .voice-btn {
            transition: all 0.3s ease;
        }
        .voice-btn.recording {
            background: linear-gradient(45deg, #ff4444, #ff6b6b);
            animation: pulse 1.5s infinite;
        }
        .quick-options {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-top: 12px;
        }
        .quick-option {
            background: linear-gradient(45deg, #FF6B9D, #FFA500);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .quick-option:hover {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }
        #chat-bubble {
            display: none;
            z-index: 999;
        }
    </style>
</head>
<body class="min-h-screen">
    <!-- Header -->
    <header class="bg-white/80 backdrop-blur-md shadow-lg border-b border-cream/30 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-6 py-4">
            <div class="flex items-center justify-between flex-wrap gap-4">
                <div class="flex items-center space-x-4">
                    <div class="text-6xl">üç¶</div>
                    <div>
                        <h1 class="text-3xl font-display font-bold text-elegant">Cream Choice</h1>
                        <p class="text-sm text-gray-600 font-medium">TRADITIONAL</p>
                        <p class="text-xs text-gray-500">Helados a base de yogurt griego</p>
                    </div>
                </div>
                <div class="flex items-center space-x-3">
                    <a href="https://www.instagram.com/_creamchoice" target="_blank" 
                       class="bg-gradient-to-r from-pink-500 to-orange-400 hover:from-pink-600 hover:to-orange-500 text-white font-medium px-4 py-2 rounded-full transition-all duration-300 flex items-center space-x-2 shadow-lg hover:shadow-xl transform hover:scale-105">
                        <span>üì∏</span>
                        <span>@_creamchoice</span>
                    </a>
                    <button id="auth-btn" onclick="toggleAuthMode()" 
                            class="bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 text-white font-medium px-4 py-2 rounded-full transition-all duration-300 flex items-center space-x-2 shadow-lg hover:shadow-xl transform hover:scale-105">
                        <span>üë§</span>
                        <span id="auth-text">Cuenta</span>
                    </button>
                    <button onclick="toggleCart()" 
                            class="bg-elegant hover:bg-gray-800 text-white font-medium px-4 py-2 rounded-full transition-all duration-300 flex items-center space-x-2 shadow-lg hover:shadow-xl">
                        <span>üõçÔ∏è</span>
                        <span>Carrito (<span id="cart-count">0</span>)</span>
                    </button>
                </div>
            </div>
        </div>
    </header>


    <!-- Informaci√≥n de la empresa -->
    <div id="company-info">
        <div class="bg-gradient-to-r from-strawberry via-passion to-blueberry text-white">
            <div class="max-w-7xl mx-auto px-6 py-16">
                <div class="text-center mb-12">
                    <h2 class="text-4xl font-display font-bold mb-4">¬°Hola! Somos Cream Choice üëã</h2>
                    <p class="text-xl opacity-90 max-w-3xl mx-auto">
                        Una helader√≠a que naci√≥ del amor por lo natural y lo delicioso
                    </p>
                </div>
                
                <div class="grid md:grid-cols-3 gap-8 text-center">
                    <div class="glass-effect rounded-2xl p-8">
                        <div class="text-4xl mb-4">üéØ</div>
                        <h3 class="text-xl font-display font-semibold mb-4">Nuestra Misi√≥n</h3>
                        <p class="opacity-90 leading-relaxed">
                            Crear helados artesanales a base de yogurt griego que sean deliciosos, 
                            saludables y accesibles para toda la familia.
                        </p>
                    </div>
                    <div class="glass-effect rounded-2xl p-8">
                        <div class="text-4xl mb-4">üåü</div>
                        <h3 class="text-xl font-display font-semibold mb-4">Nuestra Visi√≥n</h3>
                        <p class="opacity-90 leading-relaxed">
                            Ser la helader√≠a favorita de Lima, demostrando que lo saludable 
                            tambi√©n puede ser s√∫per rico y divertido.
                        </p>
                    </div>
                    <div class="glass-effect rounded-2xl p-8">
                        <div class="text-4xl mb-4">üíö</div>
                        <h3 class="text-xl font-display font-semibold mb-4">Nuestros Valores</h3>
                        <ul class="opacity-90 space-y-2 text-left">
                            <li>ü•õ Yogurt griego de calidad</li>
                            <li>üçì Frutas naturales frescas</li>
                            <li>ü•Ñ Utensilios biodegradables</li>
                            <li>üí∞ Precios justos</li>
                            <li>üòä Servicio con amor</li>
                        </ul>
                    </div>
                </div>
                
                <div class="mt-16 text-center glass-effect rounded-2xl p-12">
                    <div class="text-5xl mb-6">üåç</div>
                    <h2 class="text-3xl font-display font-bold mb-6">Cuidamos el Planeta y Ayudamos al Mundo</h2>
                    <p class="text-lg opacity-90 max-w-4xl mx-auto leading-relaxed mb-8">
                        Cada helado viene con <strong>vasos y cucharadas 100% biodegradables</strong>. Porque creemos que 
                        disfrutar algo delicioso no debe da√±ar nuestro hogar. ¬°El planeta y tu paladar 
                        te lo agradecer√°n! ü•Ñüå±
                    </p>
                    
                    <!-- Programa Trae tu Cuchara -->
                    <div class="bg-gradient-to-r from-blue-100/50 to-green-100/50 rounded-2xl p-8 mt-8 border border-blue-200/50">
                        <div class="flex items-center justify-center space-x-3 mb-4">
                            <div class="text-4xl">üçΩÔ∏è</div>
                            <h3 class="text-2xl font-display font-bold text-blue-800">Programa "Trae tu Cuchara"</h3>
                            <div class="text-4xl">üí´</div>
                        </div>
                        <p class="text-lg text-blue-800 opacity-90 max-w-3xl mx-auto leading-relaxed mb-6">
                            ¬øTraes tu propia cuchara eco-friendly (metal, madera, bamb√∫, cer√°mica)? ¬°Perfecto! 
                            <strong>No aceptamos cucharas de pl√°stico.</strong> No solo evitas el uso de cucharas biodegradables, 
sino que adem√°s <strong>donamos el 10% del costo de tu helado al World Food Programme</strong>
                            para alimentar personas necesitadas alrededor del mundo.
                        </p>
                        <div class="grid md:grid-cols-3 gap-6 text-center">
                            <div class="bg-white/70 rounded-xl p-4">
                                <div class="text-3xl mb-2">üå±</div>
                                <h4 class="font-bold text-green-700 mb-2">Cuidas el Planeta</h4>
                                <p class="text-sm text-green-600">Reduces el uso de utensilios desechables</p>
                            </div>
                            <div class="bg-white/70 rounded-xl p-4">
                                <div class="text-3xl mb-2">üíù</div>
                                <h4 class="font-bold text-pink-700 mb-2">Alimentas Esperanzas</h4>
                                <p class="text-sm text-pink-600">Ayudas a combatir el hambre mundial</p>
                            </div>
                            <div class="bg-white/70 rounded-xl p-4">
                                <div class="text-3xl mb-2">üåé</div>
                                <h4 class="font-bold text-blue-700 mb-2">Haces la Diferencia</h4>
                                <p class="text-sm text-blue-600">Tu helado tiene un impacto social positivo</p>
                            </div>
                        </div>
                        <a href="https://www.wfp.org/support-us" target="_blank" 
                           class="inline-block mt-6 bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-full transition-colors font-medium">
                            Conoce m√°s sobre el World Food Programme ‚Üí
                        </a>
                    </div>
                    
                    <!-- Impacto Social Cream Choice -->
                    <div class="mt-12 bg-gradient-to-r from-green-100/50 to-blue-100/50 rounded-2xl p-8 border border-green-200/50">
                        <div class="flex items-center justify-center space-x-3 mb-6">
                            <div class="text-4xl">üåç</div>
                            <h2 class="text-2xl font-display font-bold text-blue-800">Nuestro Impacto Social</h2>
                            <div class="text-4xl">üíù</div>
                        </div>
                        <div class="grid md:grid-cols-2 gap-8">
                            <div class="bg-white/70 rounded-xl p-6 text-center">
                                <div class="text-4xl mb-3">üí∞</div>
                                <h3 class="text-3xl font-bold text-green-700">S/ <span id="total-donated">0.00</span></h3>
                                <p class="text-sm text-green-600">Total donado al WFP</p>
                            </div>
                            <div class="bg-white/70 rounded-xl p-6 text-center">
                                <div class="text-4xl mb-3">üçΩÔ∏è</div>
                                <h3 class="text-3xl font-bold text-blue-700"><span id="meals-funded">0</span></h3>
                                <p class="text-sm text-blue-600">Comidas financiadas</p>
                            </div>
                        </div>
                        <p class="text-sm text-blue-700 mt-6 text-center opacity-80" onclick="checkAdminAccess()">¬°Cada cuchara eco-friendly que traes alimenta esperanzas! ü•Ñ‚ú®</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="max-w-7xl mx-auto px-6 py-12">
        <div class="grid lg:grid-cols-4 gap-8">
            <!-- Constructor de helados -->
            <div class="lg:col-span-3">
                <div class="space-y-12">
                    <!-- T√≠tulo principal -->
                    <div class="text-center">
                        <h2 class="text-4xl font-display font-bold gradient-text mb-4">
                            ¬°Arma tu helado perfecto!
                        </h2>
                        <p class="text-gray-600 text-lg">
                            Sigue estos pasitos y crea la combinaci√≥n que m√°s te guste üòã
                        </p>
                    </div>

                    <!-- Paso 1: Cantidad de bolas -->
                    <div class="card-elegant rounded-2xl p-8">
                        <div class="flex items-center space-x-3 mb-6">
                            <div class="w-8 h-8 bg-gradient-to-r from-strawberry to-passion rounded-full flex items-center justify-center text-white font-bold">1</div>
                            <h3 class="text-2xl font-display font-semibold text-elegant">¬øCu√°ntas bolitas quieres?</h3>
                            <div class="text-2xl">üç¶</div>
                        </div>
                        <div class="grid md:grid-cols-3 gap-4" id="scoops-options">
                            <!-- Las opciones de bolas se cargar√°n aqu√≠ -->
                        </div>
                    </div>

                    <!-- Paso 2: Seleccionar sabores -->
                    <div id="flavors-selection" class="card-elegant rounded-2xl p-8 hidden">
                        <div class="flex items-center space-x-3 mb-6">
                            <div class="w-8 h-8 bg-gradient-to-r from-passion to-lucuma rounded-full flex items-center justify-center text-white font-bold">2</div>
                            <h3 class="text-2xl font-display font-semibold text-elegant">¬°Elige tus sabores favoritos!</h3>
                            <div class="text-2xl">üé®</div>
                        </div>
                        <p class="text-gray-600 mb-6" id="flavor-instruction">
                            <!-- Instrucci√≥n din√°mica seg√∫n cantidad de bolas -->
                        </p>
                        <div class="grid md:grid-cols-2 gap-6" id="flavors-options">
                            <!-- Los sabores se cargar√°n aqu√≠ -->
                        </div>
                    </div>

                    <!-- Paso 4: Seleccionar tama√±o -->
                    <div id="size-selection" class="card-elegant rounded-2xl p-8 hidden">
                        <div class="flex items-center space-x-3 mb-6">
                            <div class="w-8 h-8 bg-gradient-to-r from-lucuma to-blueberry rounded-full flex items-center justify-center text-white font-bold">4</div>
                            <h3 class="text-2xl font-display font-semibold text-elegant">¬øQu√© tama√±o prefieres?</h3>
                            <div class="text-2xl">ü•Ñ</div>
                        </div>
                        <div class="grid md:grid-cols-3 lg:grid-cols-5 gap-4 mb-8" id="size-options">
                            <!-- Los tama√±os se cargar√°n aqu√≠ -->
                        </div>
                        <div class="bg-gradient-to-r from-green-50 to-blue-50 p-6 rounded-xl text-center border border-green-200">
                            <div class="text-3xl mb-2">üå±</div>
                            <p class="text-green-800 font-medium">
                                ¬°Vaso y cucharada 100% biodegradables incluidos!
                            </p>
                            <p class="text-green-600 text-sm mt-1">
                                Sin costo extra - Cuidamos el planeta con cada helado
                            </p>
                        </div>
                        
                        <!-- Opci√≥n de cuchara propia -->
                        <div class="mt-6 bg-gradient-to-r from-blue-50 to-purple-50 p-6 rounded-xl border border-blue-200">
                            <div class="flex items-center justify-center space-x-3 mb-4">
                                <div class="text-3xl">üåç</div>
                                <h4 class="text-xl font-bold text-blue-800">Programa "Trae tu Cuchara"</h4>
                                <div class="text-3xl">‚ú®</div>
                            </div>
                            <div class="text-center">
                                <label class="flex items-center justify-center space-x-3 cursor-pointer">
                                    <input type="checkbox" id="bring-own-spoon" class="w-5 h-5 text-blue-600 rounded" onchange="toggleOwnSpoon()">
                                    <span class="text-blue-800 font-medium">Traigo mi propia cuchara eco-friendly (metal, madera, bamb√∫, cer√°mica)</span>
                                </label>
                                <p class="text-xs text-red-600 mt-1 font-medium">‚ùå No aceptamos cucharas de pl√°stico</p>
                                <div class="mt-3 text-sm text-blue-700">
                                    üçΩÔ∏è <strong>Beneficios:</strong> No recibir√°s cuchara biodegradable (vaso s√≠ incluido)<br>
üåê <strong>Impacto:</strong> 10% del costo va a <strong>World Food Programme</strong><br>
                                    üåé <strong>Resultado:</strong> ¬°Ayudas a alimentar personas necesitadas!
                                </div>
                                <a href="https://www.wfp.org/support-us" target="_blank" 
                                   class="inline-block mt-2 text-xs text-blue-600 hover:text-blue-800 underline">
                                    Conoce m√°s sobre el World Food Programme ‚Üí
                                </a>
                            </div>
                        </div>
                    </div>

                    <!-- Paso 3: Toppings -->
                    <div id="toppings-selection" class="card-elegant rounded-2xl p-8 hidden">
                        <div class="flex items-center space-x-3 mb-6">
                            <div class="w-8 h-8 bg-gradient-to-r from-blueberry to-strawberry rounded-full flex items-center justify-center text-white font-bold">3</div>
                            <h3 class="text-2xl font-display font-semibold text-elegant">¬øQuieres agregar algo extra?</h3>
                            <div class="text-2xl">‚ú®</div>
                        </div>
                        <p class="text-gray-600 mb-8">¬°Los toppings son opcionales! Pero hacen tu helado a√∫n m√°s especial üòç</p>
                        <div id="toppings-container">
                            <!-- Los toppings se cargar√°n aqu√≠ -->
                        </div>
                    </div>

                    <!-- Paso 5: Finalizar -->
                    <div id="checkout-section" class="card-elegant rounded-2xl p-8 hidden">
                        <div class="flex items-center space-x-3 mb-6">
                            <div class="w-8 h-8 bg-gradient-to-r from-strawberry to-blueberry rounded-full flex items-center justify-center text-white font-bold">5</div>
                            <h3 class="text-2xl font-display font-semibold text-elegant">¬°Casi listo!</h3>
                            <div class="text-2xl">üéâ</div>
                        </div>
                        <div class="grid lg:grid-cols-2 gap-8">
                            <div>
                                <h4 class="text-lg font-semibold text-elegant mb-4">Cantidad y total:</h4>
                                <div class="flex items-center justify-center space-x-6 mb-8">
                                    <button onclick="changeQuantity(-1)" 
                                            class="w-12 h-12 bg-gray-100 hover:bg-gray-200 rounded-full flex items-center justify-center transition-colors text-xl font-bold">
                                        ‚àí
                                    </button>
                                    <div class="text-center">
                                        <div class="text-3xl font-bold text-elegant" id="quantity">1</div>
                                        <div class="text-gray-500 text-sm">unidades</div>
                                    </div>
                                    <button onclick="changeQuantity(1)" 
                                            class="w-12 h-12 bg-gray-100 hover:bg-gray-200 rounded-full flex items-center justify-center transition-colors text-xl font-bold">
                                        +
                                    </button>
                                </div>
                                
                                <div class="bg-gradient-to-r from-strawberry to-blueberry text-white p-8 rounded-2xl text-center mb-6">
                                    <p class="text-lg mb-2 opacity-90">Total a pagar:</p>
                                    <p class="text-5xl font-bold" id="total-price">S/ 0.00</p>
                                </div>

                                <button onclick="addToCart()" 
                                        class="w-full bg-gradient-to-r from-elegant to-gray-700 hover:from-gray-800 hover:to-gray-900 text-white font-bold py-4 rounded-2xl transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-[1.02] text-lg">
                                    üõí ¬°Agregar al carrito!
                                </button>
                            </div>
                            <div>
                                <h4 class="text-lg font-semibold text-elegant mb-4">Informaci√≥n nutricional:</h4>
                                <div class="bg-gradient-to-br from-green-50 to-blue-50 p-6 rounded-2xl border border-green-200">
                                    <div id="nutrition-info" class="grid grid-cols-2 gap-4 text-sm">
                                        <!-- Info nutricional se carga aqu√≠ -->
                                    </div>
                                    <div class="mt-6 pt-4 border-t border-green-200 text-center">
                                        <p class="text-green-700 font-medium">
                                            üíö A base de yogurt griego natural
                                        </p>
                                        <p class="text-xs text-green-600 mt-1">
                                            Valores para <span id="nutrition-quantity">1</span> unidad(es)
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Estado inicial -->
                    <div id="initial-state" class="text-center py-16">
                        <div id="locked-state">
                            <div class="text-8xl mb-6 pulse-gentle">üîí</div>
                            <h3 class="text-2xl font-display font-semibold text-elegant mb-4">
                                ¬°Reg√≠strate primero para continuar!
                            </h3>
                            <p class="text-gray-600 text-lg">
                                Necesitas crear una cuenta para poder armar tu helado ideal üòä
                            </p>
                            <button onclick="scrollToRegistration()" class="mt-4 bg-gradient-to-r from-orange-500 to-red-500 text-white px-8 py-3 rounded-lg hover:from-orange-600 hover:to-red-600 transition-colors font-semibold">
                                Ir a registrarme
                            </button>
                        </div>
                        
                        <div id="unlocked-state" class="hidden">
                            <div class="text-8xl mb-6 pulse-gentle">üéÜ</div>
                            <h3 class="text-2xl font-display font-semibold text-elegant mb-4">
                                ¬°Empecemos por el primer paso!
                            </h3>
                            <p class="text-gray-600 text-lg">
                                Dime cu√°ntas bolitas quieres y armamos tu helado ideal üòä
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Carrito -->
            <div class="lg:block">
                <div class="sticky top-24">
                    <div class="card-elegant rounded-2xl p-6" id="cart-container">
                        <div class="text-center py-12">
                            <div class="text-6xl mb-4">üõí</div>
                            <h3 class="text-xl font-semibold text-elegant mb-2">Tu carrito est√° vac√≠o</h3>
                            <p class="text-gray-500">¬°Crea tu helado perfecto y aparecer√° aqu√≠!</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Sistema de Registro (Obligatorio) -->
    <div class="max-w-6xl mx-auto px-6 py-12">
        <div id="registration-required" class="bg-gradient-to-r from-orange-50 to-yellow-50 rounded-2xl shadow-xl p-8">
            <div class="text-center mb-8">
                <div class="text-6xl mb-4">üéÜ</div>
                <h2 class="text-4xl font-bold text-orange-800 mb-4">¬°Reg√≠strate para continuar!</h2>
                <p class="text-orange-700 text-lg max-w-3xl mx-auto">Para hacer tu pedido necesitas registrarte. Recibir√°s <strong>promociones exclusivas</strong> por Instagram y Gmail, adem√°s de poder <strong>ver cu√°nto has ayudado</strong> con tus donaciones al WFP.</p>
            </div>
            
            <!-- Niveles de Usuario -->
            <div class="grid md:grid-cols-3 gap-4 mb-8">
                <div class="bg-white p-4 rounded-xl border-2 border-gray-200">
                    <div class="text-center">
                        <div class="text-3xl mb-2">üìß</div>
                        <h3 class="font-bold text-orange-800 text-lg mb-2">CLIENTE B√ÅSICO</h3>
                        <div class="bg-green-100 text-green-800 px-2 py-1 rounded-full text-xs font-bold mb-3">GRATIS</div>
                        <div class="space-y-1 text-xs text-left">
                            <p>‚Ä¢ Promociones Instagram ‚Üí Gmail</p>
                            <p>‚Ä¢ Ver cu√°nto has donado al WFP</p>
                        </div>
                    </div>
                </div>
                <div class="bg-white p-4 rounded-xl border-2 border-purple-400">
                    <div class="text-center">
                        <div class="text-3xl mb-2">üíé</div>
                        <h3 class="font-bold text-orange-800 text-lg mb-2">CLIENTE PREMIUM</h3>
                        <div class="bg-purple-100 text-purple-800 px-2 py-1 rounded-full text-xs font-bold mb-3">S/ 60/a√±o</div>
                        <div class="space-y-1 text-xs text-left">
                            <p>‚Ä¢ Todo lo anterior +</p>
                            <p>‚Ä¢ <strong>Historial de sabores</strong></p>
                            <p>‚Ä¢ <strong>Descuentos especiales</strong></p>
                            <p>‚Ä¢ <strong>Acceso a Medio Litro</strong></p>
                        </div>
                        <button class="mt-3 bg-purple-400 hover:bg-purple-500 text-white px-3 py-1 rounded-lg text-xs font-semibold transition-colors">
                            Upgrade Premium
                        </button>
                    </div>
                </div>
                <div class="bg-white p-4 rounded-xl border-2 border-yellow-400">
                    <div class="text-center">
                        <div class="text-3xl mb-2">üåÜ</div>
                        <h3 class="font-bold text-orange-800 text-lg mb-2">CLIENTE VIP</h3>
                        <div class="bg-yellow-400 text-yellow-900 px-2 py-1 rounded-full text-xs font-bold mb-3">S/ 120/a√±o</div>
                        <div class="space-y-1 text-xs text-left">
                            <p>‚Ä¢ Todo lo anterior +</p>
                            <p>‚Ä¢ <strong>Acceso a Un Litro</strong></p>
                            <p>‚Ä¢ <strong>Prioridad en atenci√≥n</strong></p>
                            <p>‚Ä¢ <strong>Promociones VIP exclusivas</strong></p>
                        </div>
                        <button class="mt-3 bg-yellow-400 hover:bg-yellow-500 text-yellow-900 px-3 py-1 rounded-lg text-xs font-semibold transition-colors">
                            Upgrade VIP
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Formulario de Registro -->
            <div class="max-w-2xl mx-auto">
                <div class="bg-white rounded-xl p-6 shadow-lg">
                    <h3 class="text-2xl font-bold text-center text-orange-800 mb-6">Crear mi cuenta</h3>
                    <div class="grid md:grid-cols-2 gap-4 mb-4">
                        <input type="text" id="reg-name" class="p-3 border border-orange-200 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent" placeholder="Tu nombre completo" required>
                        <input type="email" id="reg-email" class="p-3 border border-orange-200 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent" placeholder="tu@email.com" required>
                    </div>
                    
                    <div class="flex items-center justify-center space-x-2 text-sm text-orange-600 mb-6">
                        <input type="checkbox" id="reg-consent" class="w-4 h-4 text-orange-600" required>
                        <label for="reg-consent">Acepto recibir promociones por email e Instagram</label>
                    </div>
                    
                    <button onclick="createAccount()" class="w-full bg-gradient-to-r from-orange-500 to-red-500 text-white font-bold py-4 rounded-lg hover:from-orange-600 hover:to-red-600 transition-colors text-lg mb-4">
                        üéÜ Crear mi cuenta y empezar a pedir
                    </button>
                    
                    <div class="text-center">
                        <p class="text-gray-600 text-sm mb-2">¬øYa tienes una cuenta?</p>
                        <button onclick="showLoginForm()" class="text-blue-600 hover:text-blue-700 font-semibold underline">
                            Iniciar sesi√≥n aqu√≠
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Formulario de Inicio de Sesi√≥n -->
        <div id="login-form-section" class="hidden bg-gradient-to-r from-blue-50 to-purple-50 rounded-2xl shadow-xl p-8">
            <div class="text-center mb-8">
                <div class="text-6xl mb-4">üîë</div>
                <h2 class="text-4xl font-bold text-blue-800 mb-4">¬°Bienvenido de vuelta!</h2>
                <p class="text-blue-700 text-lg max-w-2xl mx-auto">Inicia sesi√≥n con tu email para acceder a tu cuenta y continuar pidiendo.</p>
            </div>
            
            <div class="max-w-md mx-auto">
                <div class="bg-white rounded-xl p-6 shadow-lg">
                    <h3 class="text-2xl font-bold text-center text-blue-800 mb-6">Iniciar Sesi√≥n</h3>
                    <div class="space-y-4">
                        <input type="email" id="login-email" class="w-full p-3 border border-blue-200 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="tu@email.com" required>
                        
                        <button onclick="loginUser()" class="w-full bg-gradient-to-r from-blue-500 to-purple-500 text-white font-bold py-3 rounded-lg hover:from-blue-600 hover:to-purple-600 transition-colors">
                            üîë Iniciar Sesi√≥n
                        </button>
                        
                        <div class="text-center">
                            <p class="text-gray-600 text-sm mb-2">¬øNo tienes una cuenta a√∫n?</p>
                            <button onclick="showRegistrationForm()" class="text-orange-600 hover:text-orange-700 font-semibold underline">
                                Registrarse aqu√≠
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Usuario Registrado -->
        <div id="user-dashboard" class="hidden bg-gradient-to-r from-green-50 to-blue-50 rounded-2xl p-6 shadow-lg">
            <div class="flex items-center justify-between mb-6">
                <div>
                    <h2 class="text-3xl font-bold text-green-800">¬°Hola <span id="dash-name"></span>! üëã</h2>
                    <p class="text-green-700">Nivel: <span id="dash-level" class="font-bold">Cliente B√°sico üìß</span></p>
                </div>
                <button onclick="showRegistration()" class="text-blue-600 hover:text-blue-700 text-sm underline">
                    Cambiar cuenta
                </button>
            </div>
            
            <div class="grid md:grid-cols-3 gap-4">
                <div class="bg-white/70 rounded-xl p-4 text-center">
                    <div class="text-2xl mb-2">üí∞</div>
                    <p class="text-sm text-gray-600">Tu aporte al WFP:</p>
                    <p class="text-xl font-bold text-blue-700">S/ <span id="dash-donations">0.00</span></p>
                </div>
                <div class="bg-white/70 rounded-xl p-4 text-center">
                    <div class="text-2xl mb-2">üçΩÔ∏è</div>
                    <p class="text-sm text-gray-600">Comidas financiadas:</p>
                    <p class="text-xl font-bold text-green-700"><span id="dash-meals">0</span></p>
                </div>
                <div class="bg-white/70 rounded-xl p-4 text-center">
                    <div class="text-2xl mb-2">üìä</div>
                    <p class="text-sm text-gray-600">Total pedidos:</p>
                    <p class="text-xl font-bold text-orange-700"><span id="dash-orders">0</span></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-gradient-to-r from-elegant via-gray-800 to-elegant text-white py-16 mt-20">
        <div class="max-w-7xl mx-auto px-6 text-center">
            <div class="text-6xl mb-6">üç¶</div>
            <h3 class="text-3xl font-display font-bold mb-4">Cream Choice</h3>
            <p class="text-xl opacity-90 mb-2">TRADITIONAL</p>
            <p class="text-gray-300 mb-8">Helados artesanales a base de yogurt griego</p>
            
            <div class="flex justify-center space-x-8 text-sm text-gray-300 flex-wrap gap-4 mb-12">
                <div class="flex items-center space-x-2">
                    <span>ü•õ</span>
                    <span>Yogurt griego natural</span>
                </div>
                <div class="flex items-center space-x-2">
                    <span>üçì</span>
                    <span>Frutas frescas</span>
                </div>
                <div class="flex items-center space-x-2">
                    <span>üå±</span>
                    <span>Eco-friendly</span>
                </div>
                <div class="flex items-center space-x-2">
                    <span>üí∞</span>
                    <span>Precios justos</span>
                </div>
            </div>

            <div class="glass-effect rounded-2xl p-8 mb-8">
                <h4 class="text-xl font-semibold mb-4">üí≥ M√©todos de pago</h4>
                <div class="flex justify-center space-x-6 flex-wrap gap-4">
                    <div class="flex items-center space-x-2">
                        <span>üì±</span>
                        <span>Yape</span>
                    </div>
                    <div class="flex items-center space-x-2">
                        <span>üí∏</span>
                        <span>Plin</span>
                    </div>
                    <div class="flex items-center space-x-2">
                        <span>üí∞</span>
                        <span>Efectivo</span>
                    </div>
                </div>
            </div>

            <div class="text-2xl font-display font-bold gradient-text">
                ¬°Gracias por elegir Cream Choice, tu opci√≥n deliciosa y saludable! üíö
            </div>
        </div>
    </footer>


    <!-- Chat Bot -->
    <div class="chat-bot">
        <!-- Globo de consulta -->
        <div id="chat-bubble" class="absolute bottom-20 right-0 bg-white rounded-2xl shadow-lg border border-gray-200 p-4 w-64 transform translate-x-0 transition-all duration-300">
            <div class="flex items-start justify-between">
                <div class="flex items-start space-x-3">
                    <div class="text-2xl">ü§ñ</div>
                    <div class="flex-1">
                        <p class="text-sm text-gray-700 font-medium mb-1">¬°Hola! üëã</p>
                        <p class="text-xs text-gray-600">¬øTienes alguna consulta sobre nuestros helados o el programa de donaciones?</p>
                    </div>
                </div>
                <button onclick="closeChatBubble()" class="text-gray-400 hover:text-gray-600 text-lg leading-none">√ó</button>
            </div>
            <div class="mt-3 flex space-x-2">
                <button onclick="openChatFromBubble()" class="bg-gradient-to-r from-strawberry to-blueberry text-white px-3 py-1 rounded-full text-xs font-medium hover:shadow-md transition-all">
                    S√≠, tengo preguntas
                </button>
                <button onclick="closeChatBubble()" class="bg-gray-100 text-gray-600 px-3 py-1 rounded-full text-xs hover:bg-gray-200 transition-all">
                    Ahora no
                </button>
            </div>
            <!-- Flecha del globo -->
            <div class="absolute bottom-[-8px] right-6 w-4 h-4 bg-white border-r border-b border-gray-200 transform rotate-45"></div>
        </div>
        
        <!-- Bot√≥n para abrir el chat -->
        <button id="chat-toggle" onclick="toggleChat()" 
                class="w-16 h-16 bg-gradient-to-r from-strawberry to-blueberry hover:from-pink-600 hover:to-purple-700 text-white rounded-full shadow-lg hover:shadow-xl transition-all duration-300 flex items-center justify-center transform hover:scale-110">
            <span class="text-2xl">ü§ñ</span>
        </button>
        
        <!-- Ventana del chat -->
        <div id="chat-window" class="chat-window">
            <!-- Header del chat -->
            <div class="bg-gradient-to-r from-strawberry to-blueberry text-white p-4 rounded-t-2xl flex items-center justify-between">
                <div class="flex items-center space-x-3">
                    <div class="text-2xl">ü§ñ</div>
                    <div>
                        <h3 class="font-semibold">Asistente Cream Choice</h3>
                        <p class="text-xs opacity-90">¬°Hola! ¬øEn qu√© puedo ayudarte?</p>
                    </div>
                </div>
                <button onclick="toggleChat()" class="text-white hover:bg-white/20 rounded-full w-8 h-8 flex items-center justify-center transition-colors">
                    ‚úï
                </button>
            </div>
            
            <!-- Mensajes -->
            <div id="chat-messages" class="chat-messages">
                <div class="message bot">
                    ¬°Hola! üòä Soy el asistente virtual de Cream Choice. ¬°Estoy aqu√≠ para ayudarte! Puedo:
                    <br>‚Ä¢ Explicarte nuestros deliciosos sabores
                    <br>‚Ä¢ Ayudarte a elegir tu helado perfecto
                    <br>‚Ä¢ Contarte sobre nuestros precios y opciones
                    <br>‚Ä¢ Resolver cualquier duda sobre Cream Choice
                    <br><br>¬øEn qu√© puedo ayudarte hoy?
                    <div class="quick-options">
                                    <button class="quick-option" onclick="sendQuickMessage('¬øQu√© sabores tienen disponibles?')">Ver sabores</button>
                                    <button class="quick-option" onclick="sendQuickMessage('¬øCu√°les son sus precios?')">Precios</button>
                                    <button class="quick-option" onclick="sendQuickMessage('¬øQu√© toppings ofrecen?')">Toppings</button>
                                    <button class="quick-option" onclick="sendQuickMessage('Cu√©ntame sobre las donaciones')">Donaciones</button>
                                    <button class="quick-option" onclick="sendQuickMessage('Ay√∫dame a elegir un sabor')">Ay√∫dame a elegir</button>
                    </div>
                </div>
            </div>
            
            <!-- Indicador de escritura -->
            <div id="typing-indicator" class="typing">
                <div class="typing-dots">
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                    <div class="typing-dot"></div>
                </div>
                <span class="text-xs text-gray-500">Escribiendo...</span>
            </div>
            
            <!-- Input del chat -->
            <div class="chat-input">
                <div class="flex space-x-2">
                    <button id="voiceBtn" onclick="toggleVoice()" 
                            class="voice-btn bg-gradient-to-r from-orange-400 to-orange-600 hover:from-orange-500 hover:to-orange-700 text-white px-4 py-3 rounded-full transition-all duration-300 text-xl">
                        üé§
                    </button>
                    <input type="text" id="chat-input" placeholder="Escribe tu mensaje o habla..." 
                           class="flex-1 px-4 py-3 border border-gray-200 rounded-full focus:outline-none focus:border-strawberry transition-colors"
                           onkeypress="handleChatKeypress(event)">
                    <button onclick="sendMessage()" 
                            class="bg-gradient-to-r from-strawberry to-blueberry hover:from-pink-600 hover:to-purple-700 text-white px-6 py-3 rounded-full transition-all duration-300 font-medium">
                        Enviar
                    </button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Datos de la aplicaci√≥n
        const iceCreams = [
            {
                id: '1',
                name: 'Fresa Natural',
                description: 'Cremoso yogurt griego con trozos de fresa fresca',
                color: 'strawberry',
                bgColor: 'from-pink-100 to-red-100',
                borderColor: 'border-strawberry',
                prices: { 1: 4.50, 2: 8.00, 3: 12.00 },
                image: 'üçì',
                category: 'natural',
                nutritionalInfo: {
                    small: { calories: 120, protein: 8, carbs: 18, fat: 3, sugar: 14, fiber: 2 },
                    medium: { calories: 160, protein: 11, carbs: 24, fat: 4, sugar: 18, fiber: 3 },
                    large: { calories: 200, protein: 14, carbs: 30, fat: 5, sugar: 22, fiber: 4 }
                }
            },
            {
                id: '2',
                name: 'Chocolate Artesanal',
                description: 'Yogurt griego con cacao org√°nico y toques de chocolate',
                color: 'chocolate',
                bgColor: 'from-amber-100 to-orange-100',
                borderColor: 'border-chocolate',
                prices: { 1: 4.00, 2: 7.50, 3: 11.00 },
                image: 'üç´',
                category: 'natural',
                nutritionalInfo: {
                    small: { calories: 140, protein: 9, carbs: 20, fat: 4, sugar: 16, fiber: 2 },
                    medium: { calories: 187, protein: 12, carbs: 27, fat: 5, sugar: 21, fiber: 3 },
                    large: { calories: 233, protein: 15, carbs: 34, fat: 6, sugar: 26, fiber: 4 }
                }
            },
            {
                id: '3',
                name: 'Maracuy√° Fresco',
                description: 'Yogurt griego con pulpa de maracuy√° fresca y natural',
                color: 'passion',
                bgColor: 'from-orange-100 to-yellow-100',
                borderColor: 'border-passion',
                prices: { 1: 4.00, 2: 7.50, 3: 11.00 },
                image: 'üß°',
                category: 'natural',
                nutritionalInfo: {
                    small: { calories: 115, protein: 7, carbs: 17, fat: 3, sugar: 13, fiber: 2 },
                    medium: { calories: 153, protein: 9, carbs: 23, fat: 4, sugar: 17, fiber: 3 },
                    large: { calories: 192, protein: 12, carbs: 28, fat: 5, sugar: 21, fiber: 4 }
                }
            },
            {
                id: '4',
                name: 'L√∫cuma Tradicional',
                description: 'Yogurt griego con l√∫cuma peruana, sabor √∫nico y tradicional',
                color: 'lucuma',
                bgColor: 'from-yellow-100 to-amber-100',
                borderColor: 'border-lucuma',
                prices: { 1: 5.00, 2: 9.00, 3: 13.00 },
                image: 'üíõ',
                category: 'natural',
                nutritionalInfo: {
                    small: { calories: 130, protein: 8, carbs: 19, fat: 3, sugar: 15, fiber: 3 },
                    medium: { calories: 173, protein: 11, carbs: 25, fat: 4, sugar: 20, fiber: 4 },
                    large: { calories: 217, protein: 14, carbs: 32, fat: 5, sugar: 25, fiber: 5 }
                }
            },
            {
                id: '5',
                name: 'Ar√°ndano Premium',
                description: 'Yogurt griego con ar√°ndanos frescos, rico en antioxidantes',
                color: 'blueberry',
                bgColor: 'from-purple-100 to-blue-100',
                borderColor: 'border-blueberry',
                prices: { 1: 7.00, 2: 12.00, 3: 17.00 },
                image: 'üíú',
                category: 'natural',
                nutritionalInfo: {
                    small: { calories: 125, protein: 8, carbs: 18, fat: 3, sugar: 14, fiber: 3 },
                    medium: { calories: 167, protein: 11, carbs: 24, fat: 4, sugar: 18, fiber: 4 },
                    large: { calories: 208, protein: 14, carbs: 30, fat: 5, sugar: 23, fiber: 5 }
                }
            }
        ];

        const toppings = [
            { id: 't1', name: 'Fresa en trozos', price: 1.50, category: 'frutas', image: 'üçì', nutrition: { calories: 15, carbs: 4, fiber: 1, sugar: 3 } },
            { id: 't3', name: 'Ar√°ndanos frescos', price: 2.00, category: 'frutas', image: 'ü´ê', nutrition: { calories: 20, carbs: 5, fiber: 2, sugar: 3 } },
            { id: 't4', name: 'Almendras picadas', price: 2.50, category: 'frutos-secos', image: 'ü•ú', nutrition: { calories: 50, protein: 2, fat: 4, carbs: 2 } },
            { id: 't5', name: 'Chispas de chocolate', price: 1.00, category: 'dulces', image: 'üç´', nutrition: { calories: 35, carbs: 5, fat: 2, sugar: 4 } },
            { id: 't6', name: 'Granola artesanal', price: 1.75, category: 'saludables', image: 'ü•£', nutrition: { calories: 40, protein: 2, carbs: 6, fat: 1, fiber: 2 } },
            { id: 't7', name: 'Miel de abeja', price: 1.50, category: 'saludables', image: 'üçØ', nutrition: { calories: 25, carbs: 7, sugar: 6 } },
            { id: 't8', name: 'Semillas de ch√≠a', price: 2.00, category: 'saludables', image: 'üå±', nutrition: { calories: 25, protein: 2, fat: 2, fiber: 3 } }
        ];

        // Estado de la aplicaci√≥n
        let selectedScoops = 0;
        let selectedFlavors = [];
        let selectedSize = '';
        let selectedToppings = [];
        let quantity = 1;
        let cart = [];
        let bringOwnSpoon = false;

        // Funciones principales
        function loadScoops() {
            const container = document.getElementById('scoops-options');
            const options = [
                { count: 1, emoji: 'üç¶', name: '1 Bolita', desc: 'Perfecta para probar' },
                { count: 2, emoji: 'üç¶üç¶', name: '2 Bolitas', desc: 'La opci√≥n m√°s popular' },
                { count: 3, emoji: 'üç¶üç¶üç¶', name: '3 Bolitas', desc: 'Para los m√°s golosos' }
            ];

            container.innerHTML = options.map(option => `
                <div class="ice-cream-card p-6 rounded-xl border-2 border-gray-200 hover:border-strawberry cursor-pointer transition-all text-center bg-gradient-to-br from-cream/30 to-white"
                     onclick="selectScoops(${option.count})">
                    <div class="text-4xl mb-3">${option.emoji}</div>
                    <h4 class="font-semibold text-elegant text-lg mb-2">${option.name}</h4>
                    <p class="text-gray-600 text-sm">${option.desc}</p>
                </div>
            `).join('');
        }

        function selectScoops(count) {
            selectedScoops = count;
            selectedFlavors = [];
            
            // Highlight selected
            document.querySelectorAll('#scoops-options > div').forEach(div => {
                div.className = div.className.replace('border-strawberry bg-strawberry/10', 'border-gray-200');
            });
            event.target.closest('div').className = event.target.closest('div').className.replace('border-gray-200', 'border-strawberry bg-strawberry/10');
            
            // Show flavors selection
            document.getElementById('flavors-selection').classList.remove('hidden');
            document.getElementById('initial-state').classList.add('hidden');
            loadFlavors();
        }

        function loadFlavors() {
            const container = document.getElementById('flavors-options');
            const instruction = document.getElementById('flavor-instruction');
            
            if (selectedScoops === 1) {
                instruction.textContent = 'Elige 1 sabor para tu helado:';
            } else {
                instruction.textContent = `Elige hasta ${selectedScoops} sabores diferentes (puedes repetir si quieres):`;
            }

            container.innerHTML = iceCreams.map(iceCream => {
                const imageElement = iceCream.image.includes('.jpg') 
                    ? `<img src="${iceCream.image}" alt="${iceCream.name}" class="w-20 h-20 object-cover rounded-xl shadow-md" />` 
                    : `<div class="text-5xl">${iceCream.image}</div>`;
                
                const currentPrice = iceCream.prices[selectedScoops] || iceCream.prices[3];
                
                return `
                    <div class="ice-cream-card p-6 rounded-xl border-2 border-gray-200 hover:border-${iceCream.color} cursor-pointer transition-all bg-gradient-to-br ${iceCream.bgColor}"
                         onclick="selectFlavor('${iceCream.id}')">
                        <div class="flex items-center space-x-4">
                            ${imageElement}
                            <div class="flex-1">
                                <h4 class="font-semibold text-elegant text-lg">${iceCream.name}</h4>
                                <p class="text-gray-600 text-sm mt-1">${iceCream.description}</p>
                                <div class="flex justify-between items-center mt-3">
                                    <span class="text-sm text-gray-600">
                                        A base de yogurt griego
                                    </span>
                                    <span class="text-xl font-bold text-${iceCream.color}">
                                        S/ ${currentPrice.toFixed(2)}
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function selectFlavor(flavorId) {
            const flavor = iceCreams.find(ice => ice.id === flavorId);
            
            // Determinar l√≠mite de sabores seg√∫n el tama√±o seleccionado
            let maxFlavors = selectedScoops;
            if (selectedSize === 'half-liter') maxFlavors = 3;
            if (selectedSize === 'full-liter') maxFlavors = 5;
            
            if (selectedFlavors.length < maxFlavors) {
                selectedFlavors.push(flavor);
            } else if (maxFlavors === 1) {
                selectedFlavors = [flavor];
            } else {
                return; // No agregar m√°s sabores si ya est√° lleno
            }

            // Ir directamente a toppings cuando se completen las bolas
            if (selectedFlavors.length === selectedScoops) {
                selectedSize = 'scoops'; // Indicador de que usamos sistema de bolas
                document.getElementById('toppings-selection').classList.remove('hidden');
                loadToppings();
                document.getElementById('checkout-section').classList.remove('hidden');
                updateTotal();
                updateNutrition();
            }
            
            // Para contenedores grandes, continuar con el flujo si ya se seleccion√≥ el tama√±o
            if (selectedSize === 'half-liter' || selectedSize === 'full-liter') {
                if (selectedFlavors.length >= 2) { // M√≠nimo 2 sabores para contenedores grandes
                    document.getElementById('toppings-selection').classList.remove('hidden');
                    loadToppings();
                    document.getElementById('checkout-section').classList.remove('hidden');
                    updateTotal();
                    updateNutrition();
                }
            }

            updateFlavorDisplay();
        }

        function updateFlavorDisplay() {
            // Actualizar visual de sabores seleccionados
            const instruction = document.getElementById('flavor-instruction');
            if (selectedFlavors.length > 0) {
                const flavorNames = selectedFlavors.map(f => f.name).join(', ');
                instruction.innerHTML = `<strong>Seleccionados:</strong> ${flavorNames} (${selectedFlavors.length}/${selectedScoops})`;
            }
        }


        function loadToppings() {
            const container = document.getElementById('toppings-container');
            const categories = [
                { key: 'frutas', name: 'üçì Frutas Frescas', color: 'strawberry' },
                { key: 'frutos-secos', name: 'ü•ú Frutos Secos', color: 'chocolate' },
                { key: 'dulces', name: 'üç≠ Dulces', color: 'passion' },
                { key: 'saludables', name: 'üå± Saludables', color: 'blueberry' }
            ];
            
            container.innerHTML = categories.map(category => {
                const categoryToppings = toppings.filter(t => t.category === category.key);
                if (categoryToppings.length === 0) return '';
                
                return `
                    <div class="mb-8">
                        <h4 class="text-lg font-semibold text-${category.color} mb-4 flex items-center space-x-2">
                            <span>${category.name}</span>
                        </h4>
                        <div class="grid sm:grid-cols-2 lg:grid-cols-3 gap-4">
                            ${categoryToppings.map(topping => {
                                const isSelected = selectedToppings.some(t => t.id === topping.id);
                                return `
                                    <div class="p-4 rounded-lg border cursor-pointer transition-all ${isSelected ? `border-${category.color} bg-${category.color}/10` : 'border-gray-200 hover:border-' + category.color + '/50'}"
                                         onclick="toggleTopping('${topping.id}')">
                                        <div class="flex items-center justify-between">
                                            <div class="flex items-center space-x-3">
                                                <span class="text-2xl">${topping.image}</span>
                                                <div>
                                                    <h5 class="font-medium text-elegant">${topping.name}</h5>
                                                    <p class="text-sm text-${category.color}">+S/ ${topping.price.toFixed(2)}</p>
                                                </div>
                                            </div>
                                            ${isSelected ? `<div class="w-6 h-6 bg-${category.color} rounded-full flex items-center justify-center"><span class="text-white text-xs">‚úì</span></div>` : ''}
                                        </div>
                                    </div>
                                `;
                            }).join('')}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function toggleTopping(id) {
            const topping = toppings.find(t => t.id === id);
            const index = selectedToppings.findIndex(t => t.id === id);
            
            if (index > -1) {
                selectedToppings.splice(index, 1);
            } else {
                selectedToppings.push(topping);
            }
            
            loadToppings();
            updateTotal();
            updateNutrition();
        }

        function changeQuantity(change) {
            quantity = Math.max(1, quantity + change);
            document.getElementById('quantity').textContent = quantity;
            document.getElementById('nutrition-quantity').textContent = quantity;
            updateTotal();
            updateNutrition();
        }

        function calculateBaseTotal() {
            if (selectedFlavors.length === 0 || !selectedSize || selectedScoops === 0) return 0;
            
            // Precios espec√≠ficos por sabor
            const flavorPrices = {
                'Chocolate Artesanal': { 1: 4.00, 2: 7.50, 3: 11.00 },
                'Maracuy√° Fresco': { 1: 4.00, 2: 7.50, 3: 11.00 },
                'Fresa Natural': { 1: 4.50, 2: 8.00, 3: 12.00 },
                'L√∫cuma Tradicional': { 1: 5.00, 2: 9.00, 3: 13.00 },
                'Ar√°ndano Premium': { 1: 7.00, 2: 12.00, 3: 17.00 }
            };
            
            // Para helados mixtos, usar el precio m√°s alto + S/ 0.50
            if (selectedFlavors.length > 1) {
                const maxPrice = Math.max(...selectedFlavors.map(f => flavorPrices[f.name][selectedScoops] || flavorPrices[f.name][3]));
                const basePrice = maxPrice + 0.50;
                const toppingsPrice = selectedToppings.reduce((sum, topping) => sum + topping.price, 0);
                return (basePrice + toppingsPrice) * quantity;
            } else {
                // Helado de un solo sabor
                const flavor = selectedFlavors[0];
                const basePrice = flavorPrices[flavor.name][selectedScoops] || flavorPrices[flavor.name][3];
                const toppingsPrice = selectedToppings.reduce((sum, topping) => sum + topping.price, 0);
                return (basePrice + toppingsPrice) * quantity;
            }
        }
        
        function updateTotal() {
            const total = calculateBaseTotal();
            if (total === 0) return;
            
            document.getElementById('total-price').textContent = `S/ ${total.toFixed(2)}`;
            updateDonationMessage();
        }

        function updateNutrition() {
            if (selectedFlavors.length === 0 || !selectedSize) return;
            
            const baseNutrition = selectedFlavors.reduce((acc, flavor) => {
                const nutrition = flavor.nutritionalInfo[selectedSize];
                return {
                    calories: acc.calories + nutrition.calories,
                    protein: acc.protein + nutrition.protein,
                    carbs: acc.carbs + nutrition.carbs,
                    fat: acc.fat + nutrition.fat,
                    sugar: acc.sugar + nutrition.sugar,
                    fiber: acc.fiber + nutrition.fiber
                };
            }, { calories: 0, protein: 0, carbs: 0, fat: 0, sugar: 0, fiber: 0 });

            const toppingsNutrition = selectedToppings.reduce((acc, topping) => {
                const nutrition = topping.nutrition;
                return {
                    calories: acc.calories + (nutrition.calories || 0),
                    protein: acc.protein + (nutrition.protein || 0),
                    carbs: acc.carbs + (nutrition.carbs || 0),
                    fat: acc.fat + (nutrition.fat || 0),
                    sugar: acc.sugar + (nutrition.sugar || 0),
                    fiber: acc.fiber + (nutrition.fiber || 0)
                };
            }, { calories: 0, protein: 0, carbs: 0, fat: 0, sugar: 0, fiber: 0 });
            
            const totalNutrition = {
                calories: (baseNutrition.calories + toppingsNutrition.calories) * quantity,
                protein: (baseNutrition.protein + toppingsNutrition.protein) * quantity,
                carbs: (baseNutrition.carbs + toppingsNutrition.carbs) * quantity,
                fat: (baseNutrition.fat + toppingsNutrition.fat) * quantity,
                sugar: (baseNutrition.sugar + toppingsNutrition.sugar) * quantity,
                fiber: (baseNutrition.fiber + toppingsNutrition.fiber) * quantity
            };
            
            document.getElementById('nutrition-info').innerHTML = `
                <div class="flex justify-between"><span>Calor√≠as:</span><span class="font-semibold">${totalNutrition.calories}</span></div>
                <div class="flex justify-between"><span>Prote√≠nas:</span><span class="font-semibold">${totalNutrition.protein.toFixed(1)}g</span></div>
                <div class="flex justify-between"><span>Carbohidratos:</span><span class="font-semibold">${totalNutrition.carbs.toFixed(1)}g</span></div>
                <div class="flex justify-between"><span>Grasas:</span><span class="font-semibold">${totalNutrition.fat.toFixed(1)}g</span></div>
                <div class="flex justify-between"><span>Az√∫cares:</span><span class="font-semibold">${totalNutrition.sugar.toFixed(1)}g</span></div>
                <div class="flex justify-between"><span>Fibra:</span><span class="font-semibold">${totalNutrition.fiber.toFixed(1)}g</span></div>
            `;
        }

        function addToCart() {
            if (selectedFlavors.length === 0 || !selectedSize) return;
            
            // Precios espec√≠ficos por sabor
            const flavorPrices = {
                'Chocolate Artesanal': { 1: 4.00, 2: 7.50, 3: 11.00 },
                'Maracuy√° Fresco': { 1: 4.00, 2: 7.50, 3: 11.00 },
                'Fresa Natural': { 1: 4.50, 2: 8.00, 3: 12.00 },
                'L√∫cuma Tradicional': { 1: 5.00, 2: 9.00, 3: 13.00 },
                'Ar√°ndano Premium': { 1: 7.00, 2: 12.00, 3: 17.00 }
            };
            
            let basePrice;
            // Para helados mixtos, usar el precio m√°s alto + S/ 0.50
            if (selectedFlavors.length > 1) {
                const maxPrice = Math.max(...selectedFlavors.map(f => flavorPrices[f.name][selectedScoops] || flavorPrices[f.name][3]));
                basePrice = maxPrice + 0.50;
            } else {
                // Helado de un solo sabor
                const flavor = selectedFlavors[0];
                basePrice = flavorPrices[flavor.name][selectedScoops] || flavorPrices[flavor.name][3];
            }
            
            const toppingsPrice = selectedToppings.reduce((sum, topping) => sum + topping.price, 0);
            const totalPrice = (basePrice + toppingsPrice) * quantity;
            
            const cartItem = {
                id: `cart-${Date.now()}`,
                scoops: selectedScoops,
                flavors: [...selectedFlavors],
                size: selectedSize,
                toppings: [...selectedToppings],
                quantity: quantity,
                totalPrice: totalPrice,
                bringOwnSpoon: bringOwnSpoon,
donationAmount: bringOwnSpoon ? (totalPrice * 0.10) : 0
            };
            
            cart.push(cartItem);
            updateCartDisplay();
            
            // Reset builder
            selectedScoops = 0;
            selectedFlavors = [];
            selectedSize = '';
            selectedToppings = [];
            quantity = 1;
            bringOwnSpoon = false;
            document.getElementById('bring-own-spoon').checked = false;
            
            // Hide all sections except first
            document.getElementById('flavors-selection').classList.add('hidden');
            document.getElementById('size-selection').classList.add('hidden');
            document.getElementById('toppings-selection').classList.add('hidden');
            document.getElementById('checkout-section').classList.add('hidden');
            document.getElementById('initial-state').classList.remove('hidden');
            
            // Reload scoops
            loadScoops();
            
            // Show success message
            showSuccessMessage();
        }

        function showSuccessMessage() {
            // Create and show a nice success message
            const message = document.createElement('div');
            message.className = 'fixed top-4 right-4 bg-gradient-to-r from-green-500 to-blue-500 text-white px-6 py-4 rounded-2xl shadow-lg z-50 transform translate-x-full transition-transform duration-300';
            message.innerHTML = `
                <div class="flex items-center space-x-3">
                    <span class="text-2xl">üéâ</span>
                    <div>
                        <div class="font-semibold">¬°Helado agregado!</div>
                        <div class="text-sm opacity-90">Revisa tu carrito</div>
                    </div>
                </div>
            `;
            document.body.appendChild(message);
            
            setTimeout(() => message.classList.remove('translate-x-full'), 100);
            setTimeout(() => {
                message.classList.add('translate-x-full');
                setTimeout(() => document.body.removeChild(message), 300);
            }, 3000);
        }

        function updateCartDisplay() {
            const container = document.getElementById('cart-container');
            const count = document.getElementById('cart-count');
            
            count.textContent = cart.length;
            
            if (cart.length === 0) {
                container.innerHTML = `
                    <div class="text-center py-12">
                        <div class="text-6xl mb-4">üõí</div>
                        <h3 class="text-xl font-semibold text-elegant mb-2">Tu carrito est√° vac√≠o</h3>
                        <p class="text-gray-500">¬°Crea tu helado perfecto y aparecer√° aqu√≠!</p>
                    </div>
                `;
                return;
            }
            
            const total = cart.reduce((sum, item) => sum + item.totalPrice, 0);
            const totalDonations = cart.reduce((sum, item) => sum + (item.donationAmount || 0), 0);
            const sizeNames = { 
                small: 'Vasito', 
                medium: 'Vaso', 
                large: 'Vaso Grande',
                'half-liter': 'Medio Litro',
                'full-liter': 'Un Litro'
            };
            
            container.innerHTML = `
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-xl font-semibold text-elegant">Mi Carrito (${cart.length})</h3>
                    <button onclick="clearCart()" class="text-red-600 hover:text-red-700 text-sm font-medium">Limpiar</button>
                </div>
                <div class="space-y-4 mb-6 max-h-96 overflow-y-auto">
                    ${cart.map((item, index) => `
                        <div class="bg-gradient-to-r from-cream/30 to-white rounded-xl p-4 border border-gray-100">
                            <div class="flex items-start justify-between mb-2">
                                <div class="flex items-center space-x-3">
                                    ${
                                        item.flavors[0].image.includes('.jpg')
                                            ? `<img src="${item.flavors[0].image}" alt="${item.flavors[0].name}" class="w-12 h-12 object-cover rounded-lg shadow-sm" />`
                                            : `<div class="text-2xl">${item.flavors[0].image}</div>`
                                    }
                                    <div class="flex-1">
                                        <h4 class="font-semibold text-elegant text-sm">
                                            ${item.flavors.length > 1 ? `${item.flavors.length} sabores` : item.flavors[0].name}
                                        </h4>
                                        <div class="text-xs text-gray-600 mt-1">
                                            <div><strong>Tama√±o:</strong> ${sizeNames[item.size]}</div>
                                            ${item.flavors.length > 1 ? `<div><strong>Sabores:</strong> ${item.flavors.map(f => f.name).join(', ')}</div>` : ''}
                                            ${item.toppings.length > 0 ? `<div><strong>Extras:</strong> ${item.toppings.map(t => t.name).join(', ')}</div>` : ''}
                                            ${item.bringOwnSpoon ? `<div class="text-blue-600"><strong>üåç Cuchara propia:</strong> Donaci√≥n S/ ${item.donationAmount.toFixed(2)} al WFP</div>` : ''}
                                        </div>
                                    </div>
                                </div>
                                <button onclick="removeFromCart(${index})" class="text-red-500 hover:text-red-700 text-lg">üóëÔ∏è</button>
                            </div>
                            <div class="flex items-center justify-between text-sm">
                                <span class="font-medium">Cantidad: ${item.quantity}</span>
                                <span class="font-bold text-elegant">S/ ${item.totalPrice.toFixed(2)}</span>
                            </div>
                        </div>
                    `).join('')}
                </div>
                <div class="border-t border-gray-200 pt-4">
                    ${totalDonations > 0 ? `
                        <div class="bg-blue-50 p-3 rounded-lg mb-4 border border-blue-200">
                            <div class="flex justify-between items-center text-sm">
                                <span class="text-blue-800 font-medium">üåç Total donaci√≥n al WFP:</span>
                                <span class="text-blue-800 font-bold">S/ ${totalDonations.toFixed(2)}</span>
                            </div>
                            <p class="text-xs text-blue-600 mt-1 text-center">¬°Gracias por ayudar a alimentar personas necesitadas!</p>
                        </div>
                    ` : ''}
                    <div class="flex justify-between items-center mb-6">
                        <span class="text-lg font-semibold text-elegant">Total:</span>
                        <span class="text-2xl font-bold text-elegant">S/ ${total.toFixed(2)}</span>
                    </div>
                    <button onclick="proceedToPayment()" class="w-full bg-gradient-to-r from-strawberry to-blueberry hover:from-pink-600 hover:to-purple-700 text-white font-bold py-3 rounded-2xl transition-all duration-300 shadow-lg hover:shadow-xl transform hover:scale-[1.02]">
                        üí≥ Proceder al pago
                    </button>
                    <div class="mt-4 text-center">
                        <p class="text-xs text-gray-500">üöö Delivery disponible ‚Ä¢ üì± Yape, Plin, Efectivo ‚Ä¢ üå± Envases 100% biodegradables</p>
                    </div>
                </div>
            `;
        }

        function removeFromCart(index) {
            cart.splice(index, 1);
            updateCartDisplay();
        }

        function clearCart() {
            cart = [];
            updateCartDisplay();
        }

        function proceedToPayment() {
            showInstagramOrderForm();
        }
        
        function showInstagramOrderForm() {
            // Crear modal con formulario para datos del cliente
            const modal = document.createElement('div');
            modal.id = 'instagram-order-modal';
            modal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
            
            const total = cart.reduce((sum, item) => sum + item.totalPrice, 0);
            const totalDonations = cart.reduce((sum, item) => sum + (item.donationAmount || 0), 0);
            
            modal.innerHTML = `
                <div class="bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
                    <div class="bg-gradient-to-r from-strawberry to-blueberry text-white p-6 rounded-t-2xl">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-3">
                                <span class="text-3xl">üì±</span>
                                <div>
                                    <h2 class="text-2xl font-bold">Hacer Pedido por Instagram</h2>
                                    <p class="text-sm opacity-90">Completa tus datos para generar el mensaje</p>
                                </div>
                            </div>
                            <button onclick="closeInstagramModal()" class="text-white hover:bg-white/20 rounded-full w-10 h-10 flex items-center justify-center">
                                ‚úï
                            </button>
                        </div>
                    </div>
                    
                    <div class="p-6">
                        <!-- Resumen del pedido -->
                        <div class="bg-gradient-to-br from-cream/50 to-yellow-50 rounded-xl p-4 mb-6 border border-cream">
                            <h3 class="font-semibold text-elegant mb-3 flex items-center space-x-2">
                                <span>üç¶</span>
                                <span>Resumen de tu pedido:</span>
                            </h3>
                            <div class="space-y-2 text-sm">
                                ${cart.map(item => {
                                    const sizeNames = { small: 'Vasito', medium: 'Vaso', large: 'Vaso Grande', 'half-liter': 'Medio Litro', 'full-liter': 'Un Litro' };
                                    return `
                                        <div class="flex justify-between items-center">
                                            <div>
                                                <strong>${item.quantity}x</strong> ${item.flavors.length > 1 ? item.flavors.length + ' sabores' : item.flavors[0].name} 
                                                (${sizeNames[item.size]})
                                                ${item.toppings.length > 0 ? '<br><span class="text-xs text-gray-600">+ ' + item.toppings.map(t => t.name).join(', ') + '</span>' : ''}
                                                ${item.bringOwnSpoon ? '<br><span class="text-xs text-blue-600">üåç Con cuchara propia (donaci√≥n S/ ' + item.donationAmount.toFixed(2) + ')</span>' : ''}
                                            </div>
                                            <strong class="text-elegant">S/ ${item.totalPrice.toFixed(2)}</strong>
                                        </div>
                                    `;
                                }).join('')}
                                <div class="border-t border-gray-200 pt-2 mt-3">
                                    <div class="flex justify-between items-center font-bold text-lg">
                                        <span>Total:</span>
                                        <span class="text-elegant">S/ ${total.toFixed(2)}</span>
                                    </div>
                                    ${totalDonations > 0 ? `
                                        <div class="flex justify-between items-center text-sm text-blue-600 mt-1">
                                            <span>üåç Total donaci√≥n WFP:</span>
                                            <span>S/ ${totalDonations.toFixed(2)}</span>
                                        </div>
                                    ` : ''}
                                </div>
                            </div>
                        </div>
                        
                        <!-- Formulario de datos del cliente -->
                        <form id="customer-form" class="space-y-4">
                            <div class="grid md:grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-elegant mb-1">Nombre *</label>
                                    <input type="text" id="customer-name" required 
                                           class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-strawberry focus:border-transparent"
                                           placeholder="Tu nombre">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-elegant mb-1">Apellido *</label>
                                    <input type="text" id="customer-lastname" required 
                                           class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-strawberry focus:border-transparent"
                                           placeholder="Tu apellido">
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-elegant mb-1">¬øPara cu√°ndo necesitas el pedido? *</label>
                                <input type="datetime-local" id="delivery-date" required 
                                       class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-strawberry focus:border-transparent">
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-elegant mb-1">¬øC√≥mo prefieres pagar? *</label>
                                <div class="grid grid-cols-3 gap-3 mb-4">
                                    <label class="flex items-center space-x-3 p-3 border border-gray-300 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors">
                                        <input type="radio" name="payment-method" value="Efectivo" class="w-4 h-4 text-green-600" required>
                                        <div class="flex items-center space-x-2">
                                            <span class="text-xl">üí∞</span>
                                            <span class="font-medium text-elegant">Efectivo</span>
                                        </div>
                                    </label>
                                    <label class="flex items-center space-x-3 p-3 border border-gray-300 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors">
                                        <input type="radio" name="payment-method" value="Yape" class="w-4 h-4 text-purple-600" required>
                                        <div class="flex items-center space-x-2">
                                            <span class="text-xl">üì±</span>
                                            <span class="font-medium text-elegant">Yape</span>
                                        </div>
                                    </label>
                                    <label class="flex items-center space-x-3 p-3 border border-gray-300 rounded-lg cursor-pointer hover:bg-gray-50 transition-colors">
                                        <input type="radio" name="payment-method" value="Plin" class="w-4 h-4 text-pink-600" required>
                                        <div class="flex items-center space-x-2">
                                            <span class="text-xl">‚ú®</span>
                                            <span class="font-medium text-elegant">Plin</span>
                                        </div>
                                    </label>
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-elegant mb-1">¬øQuieres colaborar con la donaci√≥n?</label>
                                <div class="bg-blue-50 p-4 rounded-lg border border-blue-200">
                                    <div class="flex items-center space-x-3 mb-2">
                                        <input type="checkbox" id="wants-donation" class="w-4 h-4 text-strawberry">
                                        <label for="wants-donation" class="text-sm font-medium text-blue-800">
                                            üåç S√≠, quiero traer mi propia cuchara eco-friendly y donar al WFP
                                        </label>
                                    </div>
                                    <p class="text-xs text-blue-600">
Al traer tu cuchara de metal/madera/bamb√∫, donaremos el 10% de tu pedido al World Food Programme para combatir el hambre mundial.
                                    </p>
                                </div>
                            </div>
                            
                            <!-- Carta de Fidelizaci√≥n -->
                            <div class="bg-gradient-to-r from-yellow-50 to-orange-50 p-4 rounded-xl border border-yellow-200">
                                <h4 class="font-semibold text-orange-800 mb-3 flex items-center space-x-2">
                                    <span>üèÜ</span>
                                    <span>Programa de Fidelizaci√≥n</span>
                                </h4>
                                
                                <div class="flex items-center justify-between mb-2">
                                    <label class="flex items-center space-x-3 cursor-pointer">
                                        <input type="checkbox" id="loyalty-card" class="w-4 h-4 text-orange-600">
                                        <span class="text-sm font-medium text-orange-800">S√≠, solicito mi Tarjeta VIP f√≠sica</span>
                                    </label>
                                </div>
                                <div id="loyalty-details" class="hidden">
                                    <div class="bg-white p-3 rounded-lg border border-orange-200 text-sm">
                                        <div class="text-center mb-3">
                                            <p class="font-bold text-orange-800">TARJETA VIP CREAM CHOICE</p>
                                            <p class="text-xs text-orange-600">Te entregaremos una tarjeta f√≠sica con tu pedido</p>
                                        </div>
                                        
                                        <div class="grid grid-cols-4 gap-2 mb-3">
                                            <div class="w-8 h-8 border-2 border-dashed border-orange-300 rounded-full flex items-center justify-center text-orange-400 text-xs">1</div>
                                            <div class="w-8 h-8 border-2 border-dashed border-orange-300 rounded-full flex items-center justify-center text-orange-400 text-xs">2</div>
                                            <div class="w-8 h-8 border-2 border-dashed border-orange-300 rounded-full flex items-center justify-center text-orange-400 text-xs">3</div>
                                            <div class="w-8 h-8 border-2 border-dashed border-orange-300 rounded-full flex items-center justify-center text-orange-400 text-xs">4</div>
                                        </div>
                                        <div class="grid grid-cols-4 gap-2 mb-3">
                                            <div class="w-8 h-8 border-2 border-dashed border-orange-300 rounded-full flex items-center justify-center text-orange-400 text-xs">5</div>
                                            <div class="w-8 h-8 border-2 border-dashed border-orange-300 rounded-full flex items-center justify-center text-orange-400 text-xs">6</div>
                                            <div class="w-8 h-8 border-2 border-dashed border-orange-300 rounded-full flex items-center justify-center text-orange-400 text-xs">7</div>
                                            <div class="w-8 h-8 border-2 border-dashed border-orange-300 rounded-full flex items-center justify-center text-orange-400 text-xs">8</div>
                                        </div>
                                        
                                        <div class="text-center text-orange-800">
                                            <p class="font-bold mb-1">üèÜ 8 COMPRAS = 1 HELADO GRATIS</p>
                                            <p class="text-xs mb-2">En cada compra sellamos 1 n√∫mero en tu tarjeta f√≠sica</p>
                                            <div class="space-y-1 text-xs">
                                                <p>‚Ä¢ V√°lido hasta S/ 12.00</p>
                                                <p>‚Ä¢ No caduca</p>
                                                <p>‚Ä¢ Solo v√°lido con tarjeta f√≠sica</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-elegant mb-1">Comentarios adicionales (opcional)</label>
                                <textarea id="customer-comments" rows="3" 
                                          class="w-full p-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-strawberry focus:border-transparent"
                                          placeholder="Alguna especificaci√≥n especial, direcci√≥n de entrega, etc."></textarea>
                            </div>
                        </form>
                        
                        <div class="flex flex-col sm:flex-row gap-3 mt-6">
                            <button onclick="closeInstagramModal()" 
                                    class="flex-1 bg-gray-100 hover:bg-gray-200 text-gray-800 font-medium py-3 px-6 rounded-xl transition-colors">
                                Cancelar
                            </button>
                            <button onclick="generateInstagramMessage()" 
                                    class="flex-1 bg-gradient-to-r from-strawberry to-blueberry hover:from-pink-600 hover:to-purple-700 text-white font-bold py-3 px-6 rounded-xl transition-all shadow-lg hover:shadow-xl">
                                üì± Enviar a Instagram
                            </button>
                        </div>
                        
                        <div class="mt-4 text-center">
                            <p class="text-xs text-gray-500">
                                Se abrir√° Instagram con el mensaje pre-escrito listo para enviar a @_creamchoice
                            </p>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            
            // Establecer fecha m√≠nima (hoy) y fecha por defecto (ma√±ana)
            const now = new Date();
            const tomorrow = new Date(now.getTime() + 24 * 60 * 60 * 1000);
            const dateInput = document.getElementById('delivery-date');
            dateInput.min = now.toISOString().slice(0, 16);
            dateInput.value = tomorrow.toISOString().slice(0, 16);
            
            // Agregar event listener para mostrar/ocultar detalles de fidelizaci√≥n
            document.getElementById('loyalty-card').addEventListener('change', function() {
                const details = document.getElementById('loyalty-details');
                if (this.checked) {
                    details.classList.remove('hidden');
                } else {
                    details.classList.add('hidden');
                }
            });
            
            // No necesitamos eventos adicionales para promociones
        }
        
        function closeInstagramModal() {
            const modal = document.getElementById('instagram-order-modal');
            if (modal) {
                document.body.removeChild(modal);
            }
        }
        
        function generateInstagramMessage() {
            // Validar formulario
            const name = document.getElementById('customer-name').value.trim();
            const lastname = document.getElementById('customer-lastname').value.trim();
            const deliveryDate = document.getElementById('delivery-date').value;
            const paymentMethod = document.querySelector('input[name="payment-method"]:checked')?.value;
            const wantsDonation = document.getElementById('wants-donation').checked;
            const comments = document.getElementById('customer-comments').value.trim();
            const loyaltyCard = document.getElementById('loyalty-card').checked;
            
            if (!name || !lastname || !deliveryDate || !paymentMethod) {
                alert('Por favor completa todos los campos obligatorios (nombre, apellido, fecha y m√©todo de pago)');
                return;
            }
            
            // Generar mensaje estructurado
            const total = cart.reduce((sum, item) => sum + item.totalPrice, 0);
            const sizeNames = { 
                small: 'Vasito (1 bola)', 
                medium: 'Vaso (2 bolas)', 
                large: 'Vaso Grande (3 bolas)',
                'half-liter': 'Medio Litro',
                'full-liter': 'Un Litro'
            };
            
            let message = `¬°Hola! Quiero hacer un pedido de Cream Choice üç¶\n\n`;
            message += `üë§ DATOS DEL CLIENTE:\n`;
            message += `‚Ä¢ Nombre: ${name} ${lastname}\n`;
            message += `‚Ä¢ Para cu√°ndo: ${formatDate(deliveryDate)}\n\n`;
            
            message += `üç® DETALLES DEL PEDIDO:\n`;
            cart.forEach((item, index) => {
                message += `\n${index + 1}. ${item.quantity}x ${sizeNames[item.size]}\n`;
                
                if (item.flavors.length === 1) {
                    message += `   Sabor: ${item.flavors[0].name}\n`;
                } else {
                    message += `   Sabores: ${item.flavors.map(f => f.name).join(', ')}\n`;
                }
                
                if (item.toppings.length > 0) {
                    message += `   Toppings: ${item.toppings.map(t => t.name).join(', ')}\n`;
                }
                
                if (item.bringOwnSpoon) {
                    message += `   üåç Con cuchara propia (donaci√≥n S/ ${item.donationAmount.toFixed(2)} al WFP)\n`;
                }
                
                message += `   Subtotal: S/ ${item.totalPrice.toFixed(2)}\n`;
            });
            
            message += `\nüí∞ TOTAL A PAGAR: S/ ${total.toFixed(2)}\n`;
            
            if (wantsDonation) {
                const totalDonationIfWanted = total * 0.10;
                message += `\nüåç DONACI√ìN:\n`;
                message += `S√≠ quiero traer mi cuchara eco-friendly y donar S/ ${totalDonationIfWanted.toFixed(2)} al World Food Programme\n`;
                message += `(Cuchara de metal/madera/bamb√∫ - NO pl√°stico)\n`;
            }
            
            if (loyaltyCard) {
                message += `\nüèÜ PROGRAMA VIP:\n`;
                message += `S√≠ quiero mi Carta de Fidelizaci√≥n VIP (8 compras = 1 helado gratis)\n`;
                message += `Por favor proporcionar tarjeta f√≠sica al recibir pedido\n`;
            }
            
            if (comments) {
                message += `\nüí¨ COMENTARIOS:\n${comments}\n`;
            }
            
            message += `\n¬°Gracias! üòä`;
            
            // REGISTRAR VENTA
            registerSaleForAnalytics(name, lastname, deliveryDate, paymentMethod, wantsDonation, comments);
            
            // Mostrar mensaje de confirmaci√≥n simple
            alert('‚úÖ Tu pedido se ha guardado exitosamente.\n\nPara m√°s consultas sobre tu pedido escr√≠benos a nuestro Instagram @_creamchoice');
            
            // Opcional: guardar mensaje en localStorage por si el cliente lo necesita despu√©s
            localStorage.setItem('ultimoPedidoMensaje', message);
            
            // Cerrar modal y limpiar carrito
            closeInstagramModal();
            clearCart();
            
            // Mostrar mensaje de √©xito
            showOrderSuccessMessage();
        }
        
        function formatDate(dateString) {
            const date = new Date(dateString);
            const options = { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric', 
                hour: '2-digit', 
                minute: '2-digit',
                timeZone: 'America/Lima'
            };
            return date.toLocaleDateString('es-PE', options);
        }
        
        function showOrderSuccessMessage() {
            const message = document.createElement('div');
            message.className = 'fixed top-4 right-4 bg-gradient-to-r from-green-500 to-blue-500 text-white px-6 py-4 rounded-2xl shadow-lg z-50 transform translate-x-full transition-transform duration-300 max-w-sm';
            message.innerHTML = `
                <div class="flex items-center space-x-3">
                    <span class="text-2xl">üéâ</span>
                    <div>
                        <div class="font-semibold">¬°Pedido guardado exitosamente!</div>
                        <div class="text-sm opacity-90">Cont√°ctanos en @_creamchoice para consultas</div>
                    </div>
                </div>
            `;
            document.body.appendChild(message);
            
            setTimeout(() => message.classList.remove('translate-x-full'), 100);
            setTimeout(() => {
                message.classList.add('translate-x-full');
                setTimeout(() => document.body.removeChild(message), 300);
            }, 5000);
        }
        
        function registerSaleForAnalytics(customerName, customerLastname, deliveryDate, paymentMethod, wantsDonation, comments) {
            // Obtener ventas existentes
            let salesHistory = JSON.parse(localStorage.getItem('creamChoiceSales') || '[]');
            
            const now = new Date();
            const fecha = now.toLocaleDateString('es-PE', { day: '2-digit', month: '2-digit', year: 'numeric' });
            const hora = now.toLocaleTimeString('es-PE', { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: false });
            
            const total = cart.reduce((sum, item) => sum + item.totalPrice, 0);
            const sizeNames = { 
                small: 'Vasito (1 bola)', 
                medium: 'Vaso (2 bolas)', 
                large: 'Vaso Grande (3 bolas)',
                'half-liter': 'Medio Litro',
                'full-liter': 'Un Litro'
            };
            
            // Calcular donaciones totales - 10% del total cuando aplique
            if (wantsDonation) {
                totalDonations = total * 0.10; // Solo 10% del total
            } else {
                // Solo donaciones de items individuales con cuchara propia
                totalDonations = cart.reduce((sum, item) => sum + (item.donationAmount || 0), 0);
            }
            
            // Crear registro de venta
            const saleRecord = {
                id: `sale-${Date.now()}`,
                fecha: fecha,
                hora: hora,
                cliente: {
                    nombre: customerName,
                    apellido: customerLastname,
                    fecha_entrega: deliveryDate,
                    comentarios: comments || 'Sin comentarios'
                },
                productos: cart.map(item => ({
                    sabores: item.flavors.length === 1 ? item.flavors[0].name : item.flavors.map(f => f.name).join(', '),
                    tama√±o: sizeNames[item.size],
                    cantidad: item.quantity,
                    precio_unitario: item.totalPrice / item.quantity,
                    precio_total: item.totalPrice,
                    toppings: item.toppings.length > 0 ? item.toppings.map(t => t.name).join(', ') : 'Sin toppings',
                    cuchara_propia: item.bringOwnSpoon ? 'S√≠' : 'No',
                    donacion_wfp: item.donationAmount || 0
                })),
                total_venta: total,
                total_donaciones: totalDonations,
                metodo_pago: 'Instagram - Pendiente',
                estado: 'Enviado por Instagram',
                donacion_adicional: wantsDonation ? totalDonations : 0,
                notas_especiales: {
                    envio_instagram: true,
                    fecha_pedido: now.toISOString(),
                    donacion_extra_solicitada: wantsDonation
                }
            };
            
            // Agregar a la lista de ventas
            salesHistory.push(saleRecord);
            
            // Guardar en localStorage
            localStorage.setItem('creamChoiceSales', JSON.stringify(salesHistory));
            
            // Mostrar confirmaci√≥n de registro
            console.log('‚úÖ Venta registrada en el sistema:', saleRecord);
            alert(`‚úÖ Pedido registrado exitosamente!\n\nCliente: ${customerName} ${customerLastname}\nTotal: S/ ${total.toFixed(2)}\nDonaci√≥n WFP: S/ ${totalDonations.toFixed(2)}\n\nSe ha guardado en el registro de ventas.`);
        }


        function toggleCart() {
            // En mobile, scroll to cart
            document.getElementById('cart-container').scrollIntoView({ behavior: 'smooth' });
        }
        

        // Chat Bot Inteligente - Base de conocimiento de Cream Choice
        let chatOpen = false;
        
        const creamChoiceKnowledge = {
            // Informaci√≥n b√°sica del emprendimiento
            empresa: {
                nombre: 'Cream Choice',
                subtitulo: 'Traditional',
                concepto: 'Helados artesanales a base de yogurt griego',
                mision: 'Crear helados saludables, conservables y deliciosos que sean accesibles para toda la familia, sin ingredientes artificiales y con precios justos',
                vision: 'Ser la helader√≠a favorita de Lima, demostrando que lo saludable tambi√©n puede ser s√∫per rico y divertido',
                valores: ['Yogurt griego de calidad', 'Frutas naturales frescas', 'Utensilios biodegradables', 'Precios justos', 'Servicio con amor'],
                instagram: '@_creamchoice',
                ubicacion: 'Emprendimiento digital, pr√≥ximamente local f√≠sico',
                delivery: true,
                ecologico: 'Vasos y cucharadas 100% biodegradables incluidos sin costo extra',
                programa_donacion: {
                    nombre: 'Programa "Trae tu Cuchara"',
                    descripcion: 'Si traes tu propia cuchara eco-friendly, donamos el 10% del costo de tu helado al World Food Programme',
                    porcentaje_donacion: '10%',
                    beneficiario: 'World Food Programme (WFP)',
                    cucharas_aceptadas: ['metal', 'madera', 'bamb√∫', 'cer√°mica', 'acero inoxidable'],
                    cucharas_no_aceptadas: ['pl√°stico', 'material desechable'],
                    beneficios: [
                        'No recibes cuchara biodegradable (vaso s√≠ incluido)',
                        '10% del costo va a combatir el hambre mundial',
                        'Reduces el uso de utensilios desechables',
                        'Tienes un impacto social positivo'
                    ],
                    requisito: 'Traer cuchara eco-friendly: metal, madera, bamb√∫ o cer√°mica. NO pl√°stico',
                    link_wfp: 'https://www.wfp.org/support-us'
                }
            },
            
            // Productos
            sabores: {
                fresa: {
                    nombre: 'Fresa Natural',
                    descripcion: 'Cremoso yogurt griego con trozos de fresa fresca',
                    caracteristicas: 'Frutal, natural, con trozos reales de fresa, sin colorantes artificiales',
                    recomendado_para: 'Amantes de sabores naturales y frutales'
                },
                chocolate: {
                    nombre: 'Chocolate Artesanal',
                    descripcion: 'Yogurt griego con cacao org√°nico y toques de chocolate',
                    caracteristicas: 'Rico, cremoso, con cacao org√°nico de alta calidad',
                    recomendado_para: 'Amantes del chocolate que buscan calidad'
                },
                maracuya: {
                    nombre: 'Maracuy√° Tropical',
                    descripcion: 'Yogurt griego con pulpa de maracuy√° fresca y natural',
                    caracteristicas: 'Ex√≥tico, tropical, sabor intenso y refrescante',
                    recomendado_para: 'Quienes buscan sabores ex√≥ticos y tropicales'
                },
                lucuma: {
                    nombre: 'L√∫cuma Tradicional',
                    descripcion: 'Yogurt griego con l√∫cuma peruana, sabor √∫nico y tradicional',
                    caracteristicas: 'Tradicional peruano, cremoso, dulce natural, el oro de los incas',
                    recomendado_para: 'Amantes de sabores tradicionales peruanos'
                },
                arandano: {
                    nombre: 'Ar√°ndano Antioxidante',
                    descripcion: 'Yogurt griego con ar√°ndanos frescos, rico en antioxidantes',
                    caracteristicas: 'Saludable, antioxidante, suave, nutritivo',
                    recomendado_para: 'Personas que buscan opciones saludables y antioxidantes'
                }
            },
            
            // Precios y tama√±os (precios espec√≠ficos por sabor)
            precios: {
                por_sabor: {
                    'Chocolate Artesanal': { 1: 4.00, 2: 7.50, 3: 11.00 },
                    'Maracuy√° Fresco': { 1: 4.00, 2: 7.50, 3: 11.00 },
                    'Fresa Natural': { 1: 4.50, 2: 8.00, 3: 12.00 },
                    'L√∫cuma Tradicional': { 1: 5.00, 2: 9.00, 3: 13.00 },
                    'Ar√°ndano Premium': { 1: 7.00, 2: 12.00, 3: 17.00 }
                },
                contenedores: {
                    medio_litro: { precio: 35.00, descripcion: 'Para llevar a casa, hasta 3 sabores', emoji: 'üç®', acceso: 'Solo clientes Premium y VIP' },
                    litro_completo: { precio: 65.00, descripcion: 'Para toda la familia, hasta 5 sabores', emoji: 'üéÇ', acceso: 'Solo clientes VIP' }
                },
                mixto: 'Para helados de sabores mixtos, se usa el precio del sabor m√°s caro + S/ 0.50',
                nota: 'Todos los precios incluyen vaso y cucharada biodegradables gratis. Precios basados en costos reales de ingredientes premium'
            },
            
            // Promociones especiales
            promociones: {
                trae_amigo: {
                    nombre: 'Promoci√≥n "Trae a un Amigo"',
                    descripcion: '20% de descuento para el cliente que trae al amigo (no para el amigo)',
                    condicion: 'Aplica solo al cliente que invita, no al invitado'
                },
                carta_vip: {
                    nombre: 'Carta VIP F√≠sica',
                    descripcion: 'Sistema 8+1: 8 compras = 1 helado gratis',
                    funcionamiento: 'Se entrega tarjeta f√≠sica que se sella con cada compra',
                    beneficio: 'Helado gratis v√°lido hasta S/ 12.00, no caduca'
                }
            },
            
            // Toppings
            toppings: {
                frutas: {
                    fresa: { nombre: 'Fresa en trozos', precio: 1.50, descripcion: 'Trozos frescos de fresa natural' },
                    arandanos: { nombre: 'Ar√°ndanos frescos', precio: 2.00, descripcion: 'Ar√°ndanos frescos ricos en antioxidantes' }
                },
                frutos_secos: {
                    almendras: { nombre: 'Almendras picadas', precio: 2.50, descripcion: 'Almendras naturales picadas, fuente de prote√≠na' }
                },
                dulces: {
                    chocolate: { nombre: 'Chispas de chocolate', precio: 1.00, descripcion: 'Chispas de chocolate de calidad' }
                },
                saludables: {
                    granola: { nombre: 'Granola artesanal', precio: 1.75, descripcion: 'Granola casera crujiente y nutritiva' },
                    miel: { nombre: 'Miel de abeja', precio: 1.50, descripcion: 'Miel natural de abeja, endulzante natural' },
                    chia: { nombre: 'Semillas de ch√≠a', precio: 2.00, descripcion: 'Semillas de ch√≠a, superalimento rico en omega-3' }
                }
            },
            
            // Sistema de membres√≠a (OBLIGATORIO registrarse)
            membresias: {
                registro_obligatorio: true,
                descripcion: 'Para hacer pedidos es necesario registrarse',
                niveles: {
                    basico: {
                        nombre: 'Cliente B√°sico',
                        precio: 'GRATIS',
                        emoji: 'üìß',
                        beneficios: [
                            'Promociones Instagram ‚Üí Gmail',
                            'Ver cu√°nto has donado al WFP'
                        ]
                    },
                    premium: {
                        nombre: 'Cliente Premium',
                        precio: 'S/ 60/a√±o',
                        precio_mensual: 'S/ 5/mes',
                        emoji: 'üíé',
                        beneficios: [
                            'Todo lo anterior +',
                            'Historial de sabores favoritos',
                            'Descuentos especiales',
                            'Acceso a Medio Litro (S/ 35.00)'
                        ]
                    },
                    vip: {
                        nombre: 'Cliente VIP',
                        precio: 'S/ 120/a√±o',
                        precio_mensual: 'S/ 10/mes',
                        emoji: 'üåÜ',
                        beneficios: [
                            'Todo lo anterior +',
                            'Acceso a Un Litro (S/ 65.00)',
                            'Prioridad en atenci√≥n',
                            'Promociones VIP exclusivas'
                        ]
                    }
                }
            },
            
            // Pagos y entrega (actualizado)
            pagos: {
                metodos: ['Yape', 'Plin', 'Efectivo contra entrega'],
                delivery: 'Disponible',
                envio_gratis: 'En pedidos mayores a S/15',
                nota_importante: 'NO aceptamos tarjetas de cr√©dito/d√©bito'
            },
            
            // Impacto social actualizado
            impacto_social: {
                total_donado: 'S/ 0.00 (se actualiza en tiempo real)',
                comidas_financiadas: '0 (se actualiza en tiempo real)',
                ubicacion: 'Mostrado debajo del programa Trae tu Cuchara en la p√°gina web'
            },
            
            // Beneficios del yogurt griego
            yogurt_griego: {
                beneficios: ['Menos az√∫car que helados tradicionales', 'M√°s prote√≠na', 'Probioticos naturales', 'Textura m√°s cremosa', 'Ingredientes naturales'],
                diferencia: 'Base de yogurt griego en lugar de crema tradicional, m√°s saludable y nutritivo'
            }
        };
        
        function toggleChat() {
            const chatWindow = document.getElementById('chat-window');
            const chatToggle = document.getElementById('chat-toggle');
            
            chatOpen = !chatOpen;
            
            if (chatOpen) {
                chatWindow.style.display = 'flex';
                chatToggle.style.transform = 'scale(0.9)';
                document.getElementById('chat-input').focus();
            } else {
                chatWindow.style.display = 'none';
                chatToggle.style.transform = 'scale(1)';
            }
        }
        
        function sendMessage() {
            const input = document.getElementById('chat-input');
            const message = input.value.trim();
            
            if (!message) return;
            
            addMessage(message, 'user');
            input.value = '';
            
            // Mostrar indicador de escritura
            showTyping();
            
            // Simular tiempo de respuesta
            setTimeout(() => {
                hideTyping();
                const response = getBotResponse(message);
                addMessage(response, 'bot');
            }, 1000 + Math.random() * 1000);
        }
        
        function handleChatKeypress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }
        
        function addMessage(text, type) {
            const messagesContainer = document.getElementById('chat-messages');
            const messageDiv = document.createElement('div');
            messageDiv.className = `message ${type}`;
            messageDiv.textContent = text;
            
            messagesContainer.appendChild(messageDiv);
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
        
        function showTyping() {
            const typingIndicator = document.getElementById('typing-indicator');
            typingIndicator.style.display = 'flex';
            
            const messagesContainer = document.getElementById('chat-messages');
            messagesContainer.scrollTop = messagesContainer.scrollHeight;
        }
        
        function hideTyping() {
            const typingIndicator = document.getElementById('typing-indicator');
            typingIndicator.style.display = 'none';
        }
        
        function getBotResponse(userMessage) {
            const message = userMessage.toLowerCase();
            const kb = creamChoiceKnowledge;
            
            // Sistema de IA que analiza la pregunta y busca la mejor respuesta
            
            // 1. Saludos
            if (message.match(/(hola|hi|buenos d√≠as|buenas tardes|buenas noches)/)) {
                return '¬°Hola! Soy el asistente de Cream Choice. ¬øEn qu√© puedo ayudarte con nuestros helados de yogurt griego?';
            }
            
            // 2. Preguntas sobre sabores espec√≠ficos
            if (message.includes('fresa')) {
                return `${kb.sabores.fresa.nombre}: ${kb.sabores.fresa.caracteristicas}. ${kb.sabores.fresa.recomendado_para}.`;
            }
            if (message.includes('chocolate')) {
                return `${kb.sabores.chocolate.nombre}: ${kb.sabores.chocolate.caracteristicas}. ${kb.sabores.chocolate.recomendado_para}.`;
            }
            if (message.includes('maracuya') || message.includes('maracuy√°')) {
                return `${kb.sabores.maracuya.nombre}: ${kb.sabores.maracuya.caracteristicas}. ${kb.sabores.maracuya.recomendado_para}.`;
            }
            if (message.includes('lucuma') || message.includes('l√∫cuma')) {
                return `${kb.sabores.lucuma.nombre}: ${kb.sabores.lucuma.caracteristicas}. ${kb.sabores.lucuma.recomendado_para}.`;
            }
            if (message.includes('arandano') || message.includes('ar√°ndano')) {
                return `${kb.sabores.arandano.nombre}: ${kb.sabores.arandano.caracteristicas}. ${kb.sabores.arandano.recomendado_para}.`;
            }
            
            // 3. Lista de sabores
            if (message.match(/(sabores|que tienen|cuales son)/)) {
                return `Tenemos 5 sabores: Fresa Natural (frutal con trozos reales), Chocolate Artesanal (con cacao org√°nico), Maracuy√° Tropical (ex√≥tico e intenso), L√∫cuma Tradicional (peruano tradicional), y Ar√°ndano Antioxidante (saludable). Todos con ${kb.empresa.concepto}.`;
            }
            
            // 4. Precios
            if (message.match(/(precio|cuanto cuesta|costo)/)) {
                return `Nuestros precios: ${kb.precios.vasito.emoji} Vasito S/${kb.precios.vasito.precio} (${kb.precios.vasito.descripcion}), ${kb.precios.vaso.emoji} Vaso S/${kb.precios.vaso.precio} (${kb.precios.vaso.descripcion}), ${kb.precios.vaso_grande.emoji} Vaso Grande S/${kb.precios.vaso_grande.precio} (${kb.precios.vaso_grande.descripcion}). ${kb.precios.nota}.`;
            }
            
            // 5. Toppings
            if (message.match(/(topping|extra|agregado)/)) {
                const toppings = [];
                Object.values(kb.toppings).forEach(categoria => {
                    Object.values(categoria).forEach(topping => {
                        toppings.push(`${topping.nombre} (S/${topping.precio})`);
                    });
                });
                return `Nuestros toppings: ${toppings.join(', ')}. Puedes combinar los que quieras!`;
            }
            
            // 6. Recomendaciones
            if (message.match(/(recomend|suger|que me das|cual es bueno)/)) {
                return `Te recomiendo: L√∫cuma con granola artesanal (sabor peruano tradicional), Fresa con trozos de fresa (s√∫per frutal), o Ar√°ndano con miel (saludable y delicioso). ¬øTienes alguna preferencia? ¬øDulce, frutal, saludable?`;
            }
            
            // 7. Sobre la empresa
            if (message.match(/(empresa|negocio|emprendimiento|quienes son)/)) {
                return `${kb.empresa.nombre} ${kb.empresa.subtitulo} es ${kb.empresa.concepto}. ${kb.empresa.mision}. Nuestra visi√≥n: ${kb.empresa.vision}. S√≠guenos en ${kb.empresa.instagram}!`;
            }
            
            // 8. Yogurt griego y salud
            if (message.match(/(saludable|diet|yogurt|griego|calorias|nutritivo)/)) {
                return `Nuestros helados son a base de yogurt griego, por eso son m√°s saludables: ${kb.yogurt_griego.beneficios.join(', ')}. ${kb.yogurt_griego.diferencia}.`;
            }
            
            // 9. Delivery y ubicaci√≥n
            if (message.match(/(delivery|envio|donde|ubicacion|local)/)) {
                return `${kb.empresa.ubicacion}. S√≠ hacemos ${kb.pagos.delivery.toLowerCase()}! ${kb.pagos.envio_gratis}. Puedes pedir desde esta p√°gina web.`;
            }
            
            // 10. Pagos
            if (message.match(/(pago|yape|plin|tarjeta|efectivo|como pagar)/)) {
                return `Aceptamos: ${kb.pagos.metodos.join(', ')}. ${kb.pagos.envio_gratis}.`;
            }
            
            // 11. Ecol√≥gico
            if (message.match(/(ecologic|medio ambiente|biodegradable|planeta)/)) {
                return `Somos eco-friendly! ${kb.empresa.ecologico}. Cuidamos el planeta con cada helado que entregas.`;
            }
            
            // 12. Instagram
            if (message.match(/(instagram|redes|fotos)/)) {
                return `S√≠guenos en ${kb.empresa.instagram} para ver fotos deliciosas de nuestros helados y novedades!`;
            }
            
            // 13. C√≥mo pedir
            if (message.match(/(como pedir|pasos|proceso)/)) {
                return 'Es f√°cil: 1) Elige cu√°ntas bolas quieres, 2) Selecciona sabores, 3) Elige tama√±o, 4) A√±ade toppings (opcional), 5) Al carrito y listo!';
            }
            
            // 14. Sistema de membres√≠a y registro
            if (message.match(/(registro|registrar|cuenta|basico|premium|vip|membresia|nivel)/)) {
                return `${kb.membresias.descripcion}. Tenemos 3 niveles:\n\n${kb.membresias.niveles.basico.emoji} **${kb.membresias.niveles.basico.nombre}** (${kb.membresias.niveles.basico.precio}): ${kb.membresias.niveles.basico.beneficios.join(', ')}\n\n${kb.membresias.niveles.premium.emoji} **${kb.membresias.niveles.premium.nombre}** (${kb.membresias.niveles.premium.precio}): ${kb.membresias.niveles.premium.beneficios.join(', ')}\n\n${kb.membresias.niveles.vip.emoji} **${kb.membresias.niveles.vip.nombre}** (${kb.membresias.niveles.vip.precio}): ${kb.membresias.niveles.vip.beneficios.join(', ')}`;
            }
            
            // 15. Precios espec√≠ficos por sabor
            if (message.match(/(precio|cuanto cuesta|costo)/) && message.match(/(sabor|especif)/)) {
                return `Tenemos precios espec√≠ficos por sabor:\n- Chocolate/Maracuy√°: S/4.00-7.50-11.00 (1-2-3 bolas)\n- Fresa: S/4.50-8.00-12.00\n- L√∫cuma: S/5.00-9.00-13.00\n- Ar√°ndano Premium: S/7.00-12.00-17.00\n\nPara sabores mixtos: precio del m√°s caro + S/0.50. ${kb.precios.nota}`;
            }
            
            // 16. Promociones especiales
            if (message.match(/(promocion|descuento|oferta|amigo|carta vip)/)) {
                return `¬°Tenemos promociones geniales!\n\nüë´ **${kb.promociones.trae_amigo.nombre}**: ${kb.promociones.trae_amigo.descripcion}\n\nüèÜ **${kb.promociones.carta_vip.nombre}**: ${kb.promociones.carta_vip.descripcion}. ${kb.promociones.carta_vip.funcionamiento}. ${kb.promociones.carta_vip.beneficio}.`;
            }
            
            // 17. Programa de donaci√≥n "Trae tu Cuchara"
            if (message.match(/(donacion|donar|cuchara|world food|wfp|ayuda|caridad|social|impacto)/)) {
                return `¬°S√≠! Tenemos el ${kb.empresa.programa_donacion.nombre}. ${kb.empresa.programa_donacion.descripcion}. IMPORTANTE: Solo aceptamos cucharas de ${kb.empresa.programa_donacion.cucharas_aceptadas.join(', ')}. NO ${kb.empresa.programa_donacion.cucharas_no_aceptadas.join(' ni ')}. \n\nHasta ahora hemos donado ${kb.impacto_social.total_donado} y financiado ${kb.impacto_social.comidas_financiadas}. ¬°Tu helado puede alimentar esperanzas!`;
            }
            
            // 15. Vegano/Lactosa
            if (message.match(/(vegan|lactosa|sin lacteos)/)) {
                return 'Nuestros helados contienen l√°cteos (yogurt griego). No tenemos opciones veganas por ahora, pero estamos trabajando en ello.';
            }
            
            // 15. Despedidas
            if (message.match(/(gracias|chau|adios|hasta luego)/)) {
                return '¬°De nada! Fue un placer ayudarte. ¬°Disfruta tu helado de Cream Choice!';
            }
            
            // 16. Respuesta inteligente por defecto
            return `Interesante pregunta sobre Cream Choice! Te puedo ayudar con: sabores (${Object.keys(kb.sabores).join(', ')}), precios, toppings, recomendaciones, delivery, pagos o cualquier otra duda. ¬øSobre qu√© te gustar√≠a saber m√°s?`;
        }

        // Funciones de reconocimiento de voz
        let isRecording = false;
        let recognition = null;
        
        if ('webkitSpeechRecognition' in window) {
            recognition = new webkitSpeechRecognition();
            recognition.continuous = false;
            recognition.interimResults = false;
            recognition.lang = 'es-ES';
            
            recognition.onstart = function() {
                console.log('Reconocimiento de voz iniciado');
            };
            
            recognition.onresult = function(event) {
                const transcript = event.results[0][0].transcript;
                document.getElementById('chat-input').value = transcript;
                console.log('Transcripci√≥n:', transcript);
            };
            
            recognition.onerror = function(event) {
                console.error('Error en reconocimiento de voz:', event.error);
                stopRecording();
            };
            
            recognition.onend = function() {
                stopRecording();
            };
        }
        
        function toggleVoice() {
            if (!recognition) {
                alert('¬°Lo siento! Tu navegador no soporta reconocimiento de voz. Prueba con Chrome.');
                return;
            }
            
            if (isRecording) {
                stopRecording();
            } else {
                startRecording();
            }
        }
        
        function startRecording() {
            if (recognition) {
                isRecording = true;
                const voiceBtn = document.getElementById('voiceBtn');
                voiceBtn.classList.add('recording');
                voiceBtn.innerHTML = 'üé§ Escuchando...';
                recognition.start();
            }
        }
        
        function stopRecording() {
            if (recognition) {
                isRecording = false;
                const voiceBtn = document.getElementById('voiceBtn');
                voiceBtn.classList.remove('recording');
                voiceBtn.innerHTML = 'üé§';
                recognition.stop();
            }
        }
        
        // Funci√≥n para enviar mensajes de opciones r√°pidas
        function sendQuickMessage(message) {
            document.getElementById('chat-input').value = message;
            sendMessage();
        }
        
        // Actualizar funci√≥n handleChatKeypress para reconocer Enter
        function handleChatKeypress(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }
        
        // Funci√≥n para manejar la opci√≥n de cuchara propia
        function toggleOwnSpoon() {
            bringOwnSpoon = document.getElementById('bring-own-spoon').checked;
            updateTotal();
            updateDonationMessage();
        }
        
        function updateDonationMessage() {
            const total = calculateBaseTotal();
            const donationAmount = bringOwnSpoon ? (total * 0.30) : 0;
            
            // Mostrar mensaje de donaci√≥n si est√° activo
            let donationDiv = document.getElementById('donation-message');
            if (!donationDiv) {
                donationDiv = document.createElement('div');
                donationDiv.id = 'donation-message';
                document.getElementById('checkout-section').appendChild(donationDiv);
            }
            
            if (bringOwnSpoon && donationAmount > 0) {
                donationDiv.innerHTML = `
                    <div class="mt-4 p-4 bg-gradient-to-r from-blue-50 to-green-50 rounded-xl border border-blue-200">
                        <div class="text-center">
                            <div class="text-2xl mb-2">üåçüíô</div>
                            <h4 class="font-bold text-blue-800 mb-2">¬°Gracias por ayudar al mundo!</h4>
                            <p class="text-sm text-blue-700 mb-2">
                                Por traer tu propia cuchara, estar√°s donando <strong>S/ ${donationAmount.toFixed(2)}</strong> 
                                al World Food Programme para alimentar personas necesitadas.
                            </p>
                            <p class="text-xs text-blue-600">
                                üçΩÔ∏è No incluiremos cuchara biodegradable (vaso s√≠) ‚Ä¢ üå± Cuidas el planeta ‚Ä¢ üíù Ayudas a otros
                            </p>
                        </div>
                    </div>
                `;
            } else {
                donationDiv.innerHTML = '';
            }
        }
        
        // Funciones para el globo de consulta
        function closeChatBubble() {
            const bubble = document.getElementById('chat-bubble');
            bubble.style.display = 'none';
            // Guardar en localStorage que el usuario cerr√≥ el globo
            localStorage.setItem('chatBubbleClosed', 'true');
        }
        
        function openChatFromBubble() {
            closeChatBubble();
            toggleChat();
        }
        
        function showChatBubble() {
            const bubble = document.getElementById('chat-bubble');
            const wasClosed = localStorage.getItem('chatBubbleClosed');
            
            // Solo mostrar si no ha sido cerrado previamente
            if (!wasClosed) {
                bubble.style.display = 'block';
                
                // Auto-ocultar despu√©s de 10 segundos si no interact√∫a
                setTimeout(() => {
                    if (bubble.style.display !== 'none') {
                        bubble.style.opacity = '0.7';
                    }
                }, 10000);
                
                // Auto-cerrar despu√©s de 30 segundos
                setTimeout(() => {
                    if (bubble.style.display !== 'none') {
                        closeChatBubble();
                    }
                }, 30000);
            }
        }
        
        // Funciones de autenticaci√≥n y registro
        function toggleAuthMode() {
            const registrationSection = document.getElementById('registration-required');
            registrationSection.scrollIntoView({ behavior: 'smooth' });
        }
        
        function showLoginForm() {
            document.getElementById('registration-required').classList.add('hidden');
            document.getElementById('login-form-section').classList.remove('hidden');
            document.getElementById('user-dashboard').classList.add('hidden');
        }
        
        function showRegistrationForm() {
            document.getElementById('registration-required').classList.remove('hidden');
            document.getElementById('login-form-section').classList.add('hidden');
            document.getElementById('user-dashboard').classList.add('hidden');
        }
        
        function scrollToRegistration() {
            const registrationSection = document.getElementById('registration-required');
            registrationSection.scrollIntoView({ behavior: 'smooth' });
        }
        
        function createAccount() {
            const name = document.getElementById('reg-name').value.trim();
            const email = document.getElementById('reg-email').value.trim();
            const consent = document.getElementById('reg-consent').checked;
            
            if (!name || !email || !consent) {
                alert('¬°Por favor completa todos los campos y acepta las promociones!');
                return;
            }
            
            // Guardar datos del usuario
            const userData = {
                name: name,
                email: email,
                level: 'basico',
                totalSpent: 0,
                totalDonated: 0,
                orders: 0,
                joinDate: new Date().toISOString()
            };
            
            localStorage.setItem('creamChoiceUser', JSON.stringify(userData));
            
            // Incrementar contador de usuarios b√°sicos
            const basicUsers = parseInt(localStorage.getItem('basicUsers') || '0') + 1;
            localStorage.setItem('basicUsers', basicUsers.toString());
            
            // Mostrar dashboard del usuario
            showUserDashboard(userData);
            
            // Desbloquear el constructor de helados
            unlockIceCreamBuilder();
            
            alert('¬°Bienvenido a Cream Choice! Tu cuenta ha sido creada exitosamente.');
        }
        
        function loginUser() {
            const email = document.getElementById('login-email').value.trim();
            
            if (!email) {
                alert('¬°Por favor ingresa tu email!');
                return;
            }
            
            // Simular b√∫squeda de usuario (en la vida real buscar√≠as en base de datos)
            const savedUser = localStorage.getItem('creamChoiceUser');
            if (savedUser) {
                const userData = JSON.parse(savedUser);
                if (userData.email === email) {
                    showUserDashboard(userData);
                    unlockIceCreamBuilder();
                    alert(`¬°Bienvenido de vuelta ${userData.name}!`);
                } else {
                    alert('Email no encontrado. ¬øEst√°s seguro que ya tienes una cuenta?');
                }
            } else {
                alert('No se encontr√≥ ninguna cuenta. ¬øTe gustar√≠a registrarte?');
            }
        }
        
        function showUserDashboard(userData) {
            // Ocultar formularios
            document.getElementById('registration-required').classList.add('hidden');
            document.getElementById('login-form-section').classList.add('hidden');
            
            // Mostrar dashboard
            document.getElementById('user-dashboard').classList.remove('hidden');
            
            // Actualizar datos
            document.getElementById('dash-name').textContent = userData.name;
            document.getElementById('dash-donations').textContent = userData.totalDonated.toFixed(2);
            document.getElementById('dash-meals').textContent = Math.floor(userData.totalDonated * 3.6); // Aproximaci√≥n
            document.getElementById('dash-orders').textContent = userData.orders;
            
            // Actualizar nivel
            let level = 'Cliente B√°sico üìß';
            if (userData.totalSpent >= 60) level = 'Cliente Premium üíé';
            if (userData.totalSpent >= 120) level = 'Cliente VIP üåÜ';
            document.getElementById('dash-level').textContent = level;
            
            // Actualizar bot√≥n del header
            document.getElementById('auth-text').textContent = userData.name;
        }
        
        function unlockIceCreamBuilder() {
            document.getElementById('locked-state').classList.add('hidden');
            document.getElementById('unlocked-state').classList.remove('hidden');
            loadScoops();
        }
        
        // Funciones de administrador
        function showAdminPanel() {
            document.getElementById('admin-panel').classList.remove('hidden');
            // Mostrar la primera pesta√±a por defecto
            showAdminTab('donations');
        }
        
        function closeAdminPanel() {
            document.getElementById('admin-panel').classList.add('hidden');
        }
        
        function showAdminTab(tab) {
            // Ocultar todas las secciones
            document.getElementById('admin-donations').classList.add('hidden');
            document.getElementById('admin-users').classList.add('hidden');
            document.getElementById('admin-goals').classList.add('hidden');
            
            // Resetear todos los tabs
            document.getElementById('tab-donations').className = 'px-4 py-2 font-semibold text-gray-600 hover:text-blue-600';
            document.getElementById('tab-users').className = 'px-4 py-2 font-semibold text-gray-600 hover:text-blue-600';
            document.getElementById('tab-goals').className = 'px-4 py-2 font-semibold text-gray-600 hover:text-blue-600';
            
            // Mostrar secci√≥n activa
            document.getElementById('admin-' + tab).classList.remove('hidden');
            document.getElementById('tab-' + tab).className = 'px-4 py-2 font-semibold text-blue-600 border-b-2 border-blue-600';
            
            // Cargar datos seg√∫n la secci√≥n
            if (tab === 'users') {
                loadUserStats();
            } else if (tab === 'goals') {
                updateGoalsProgress();
            }
        }
        
        function updateDonationStats() {
            const donated = document.getElementById('admin-donated').value;
            const meals = document.getElementById('admin-meals').value;
            
            if (donated !== '') {
                document.getElementById('total-donated').textContent = parseFloat(donated).toFixed(2);
                localStorage.setItem('totalDonated', donated);
            }
            
            if (meals !== '') {
                document.getElementById('meals-funded').textContent = parseInt(meals);
                localStorage.setItem('mealsFunded', meals);
            }
            
            alert('‚úÖ Impacto social actualizado correctamente!');
        }
        
        function loadUserStats() {
            // Obtener datos reales de usuarios registrados
            const stats = {
                basic: parseInt(localStorage.getItem('basicUsers') || '0'),
                premium: parseInt(localStorage.getItem('premiumUsers') || '0'),
                vip: parseInt(localStorage.getItem('vipUsers') || '0')
            };
            
            document.getElementById('basic-users').textContent = stats.basic;
            document.getElementById('premium-users').textContent = stats.premium;
            document.getElementById('vip-users').textContent = stats.vip;
            
            // Calcular ingresos reales
            const premiumRevenue = stats.premium * 60;
            const vipRevenue = stats.vip * 120;
            const totalRevenue = premiumRevenue + vipRevenue;
            
            document.getElementById('premium-revenue').textContent = premiumRevenue.toFixed(2);
            document.getElementById('vip-revenue').textContent = vipRevenue.toFixed(2);
            document.getElementById('total-revenue').textContent = totalRevenue.toFixed(2);
        }
        
        function updateGoalsData() {
            // Actualizar datos en tiempo real
            const currentUsers = {
                basic: parseInt(document.getElementById('basic-users').textContent || '0'),
                premium: parseInt(document.getElementById('premium-users').textContent || '0'),
                vip: parseInt(document.getElementById('vip-users').textContent || '0')
            };
            
            const totalUsers = currentUsers.basic + currentUsers.premium + currentUsers.vip;
            const totalRevenue = currentUsers.premium * 60 + currentUsers.vip * 120;
            const donatedAmount = parseFloat(document.getElementById('total-donated').textContent || '0');
            
            // Actualizar displays
            document.getElementById('total-users-display').textContent = totalUsers;
            document.getElementById('wfp-donated-display').textContent = donatedAmount.toFixed(2);
            
            // Mostrar progreso
            const progressPercent = Math.round((totalUsers / 200) * 100); // Meta de 200 usuarios
            const revenuePercent = Math.round((totalRevenue / 96000) * 100); // Meta de S/ 96,000
            const donationPercent = Math.round((donatedAmount / 3000) * 100); // Meta de S/ 3,000
            
            let report = '‚úÖ Progreso actualizado:\n\n';
            report += `üë• Usuarios: ${totalUsers}/200 (${progressPercent}%)\n`;
            report += `üí∞ Ingresos anuales: S/ ${totalRevenue}/96,000 (${revenuePercent}%)\n`;
            report += `üåç Donaciones: S/ ${donatedAmount}/3,000 (${donationPercent}%)\n\n`;
            
            if (progressPercent >= 50) {
                report += 'üéâ ¬°Vas muy bien! Ya alcanzaste m√°s del 50% de tus metas.';
            } else {
                report += 'üí™ ¬°Sigue adelante! Cada usuario nuevo te acerca m√°s a tus objetivos.';
            }
            
            alert(report);
        }
        
        function loadSavedStats() {
            const savedDonated = localStorage.getItem('totalDonated');
            const savedMeals = localStorage.getItem('mealsFunded');
            
            if (savedDonated) {
                document.getElementById('total-donated').textContent = parseFloat(savedDonated).toFixed(2);
            }
            
            if (savedMeals) {
                document.getElementById('meals-funded').textContent = parseInt(savedMeals);
            }
        }
        
        
        // Sistema de registro de membres√≠as
        function registerForPremium() {
            const userData = localStorage.getItem('creamChoiceUser');
            if (userData) {
                const user = JSON.parse(userData);
                if (user.level === 'basico') {
                    user.level = 'premium';
                    user.totalSpent = 60;
                    localStorage.setItem('creamChoiceUser', JSON.stringify(user));
                    
                    // Actualizar contador de usuarios premium
                    const premiumUsers = parseInt(localStorage.getItem('premiumUsers') || '0') + 1;
                    const basicUsers = parseInt(localStorage.getItem('basicUsers') || '0') - 1;
                    localStorage.setItem('premiumUsers', premiumUsers.toString());
                    localStorage.setItem('basicUsers', Math.max(0, basicUsers).toString());
                    
                    showUserDashboard(user);
                    alert('¬°Felicitaciones! Te has registrado como Cliente Premium \u{1F48E}');
                } else {
                    alert('Ya tienes una membres√≠a activa.');
                }
            }
        }
        
        function registerForVIP() {
            const userData = localStorage.getItem('creamChoiceUser');
            if (userData) {
                const user = JSON.parse(userData);
                if (user.level !== 'vip') {
                    const previousLevel = user.level;
                    user.level = 'vip';
                    user.totalSpent = 120;
                    localStorage.setItem('creamChoiceUser', JSON.stringify(user));
                    
                    // Actualizar contadores
                    const vipUsers = parseInt(localStorage.getItem('vipUsers') || '0') + 1;
                    localStorage.setItem('vipUsers', vipUsers.toString());
                    
                    if (previousLevel === 'premium') {
                        const premiumUsers = parseInt(localStorage.getItem('premiumUsers') || '0') - 1;
                        localStorage.setItem('premiumUsers', Math.max(0, premiumUsers).toString());
                    } else if (previousLevel === 'basico') {
                        const basicUsers = parseInt(localStorage.getItem('basicUsers') || '0') - 1;
                        localStorage.setItem('basicUsers', Math.max(0, basicUsers).toString());
                    }
                    
                    showUserDashboard(user);
                    alert('¬°Felicitaciones! Te has registrado como Cliente VIP \u{1F306}');
                } else {
                    alert('Ya eres Cliente VIP.');
                }
            }
        }
        
        function updateGoalsProgress() {
            // Actualizar solo los displays sin mostrar alerta
            const currentUsers = {
                basic: parseInt(document.getElementById('basic-users').textContent || '0'),
                premium: parseInt(document.getElementById('premium-users').textContent || '0'),
                vip: parseInt(document.getElementById('vip-users').textContent || '0')
            };
            
            const totalUsers = currentUsers.basic + currentUsers.premium + currentUsers.vip;
            const donatedAmount = parseFloat(document.getElementById('total-donated').textContent || '0');
            
            // Actualizar displays
            document.getElementById('total-users-display').textContent = totalUsers;
            document.getElementById('wfp-donated-display').textContent = donatedAmount.toFixed(2);
        }
        
        // Inicializar aplicaci√≥n
        document.addEventListener('DOMContentLoaded', function() {
            loadScoops();
            updateCartDisplay();
            loadSavedStats();
            
            // Verificar si ya hay un usuario logueado
            const savedUser = localStorage.getItem('creamChoiceUser');
            if (savedUser) {
                const userData = JSON.parse(savedUser);
                showUserDashboard(userData);
                unlockIceCreamBuilder();
            }
            
            // Mostrar globo de consulta despu√©s de 3 segundos
            setTimeout(showChatBubble, 3000);
        });
    </script>
</body>
</html>